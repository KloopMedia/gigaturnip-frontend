(this["webpackJsonpgigaturnip-frontend"]=this["webpackJsonpgigaturnip-frontend"]||[]).push([[0],{300:function(e){e.exports=JSON.parse('{"type":"object","title":"Stage options","description":"Describe the stage you want.","properties":{"name":{"title":"Stage name","type":"string","description":"Example: Violation description form"},"description":{"title":"Stage description","type":"string","description":"Example: Form that describes an election violation","default":""},"is_creatable":{"type":"boolean","title":"Task is creatable","default":false},"copy_input":{"type":"boolean","title":"Copy input","default":false},"webhook_address":{"title":"Webhook address","type":"string","format":"uri"},"webhook_params":{"title":"Webhook parameters","type":"string"},"library":{"title":"Library","type":"string","default":""},"displayed_prev_stages":{"items":{"type":"number","title":"Stage"},"title":"Background Stages","type":"array"},"external_metadata":{"title":"External metadata","type":"object","properties":{"slides":{"type":"array","title":"Slides","items":{"type":"string"}}}}},"dependencies":{},"required":["name"]}')},310:function(e){e.exports=JSON.parse('{"title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0446\u0435\u043f\u043e\u0447\u043a\u0438","type":"object","required":["name"],"properties":{"name":{"type":"string","title":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},"description":{"type":"string","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}}}')},311:function(e){e.exports=JSON.parse('{"description":{"ui:widget":"textarea"}}')},341:function(e,t,n){},367:function(e,t,n){},557:function(e,t,n){},558:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(34),i=n.n(r),o=(n(341),n(36)),s=n(28),u=n(3),l=n.n(u),d=n(6),j=n(11),p=n(286),b=n(85),h=(Object(p.a)({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"}),Object(b.b)()),f=new b.a;f.setCustomParameters({prompt:"select_account"});var O=n(2),m=c.a.createContext(null),g=function(e){var t=e.children,n=Object(a.useState)(null),c=Object(j.a)(n,2),r=c[0],i=c[1],o=Object(a.useState)(!1),s=Object(j.a)(o,2),u=s[0],p=s[1];Object(a.useEffect)((function(){Object(b.d)(h,function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(t||null),p(!0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var g={user:r,ready:u,getToken:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.c)(r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),login:function(e){return Object(b.e)(h,f).then((function(t){var n=t.user;console.log(n),i(n),e()}))},logout:function(e){return Object(b.f)(h).then((function(){i(null),e()}))}};return Object(O.jsx)(m.Provider,{value:g,children:t})},x=function(){return c.a.useContext(m)},v={title:"Login",path:"/login"},y=n(629),S=function(e){var t=e.children,n=x(),a=Object(s.h)();return console.log(n),n.ready&&!n.user?Object(O.jsx)(s.a,{to:v.path,state:{from:a}}):n.ready?t:Object(O.jsx)(y.a,{})},w="api/v1/chains/",C="api/v1/taskstages/",k="api/v1/conditionalstages/",_="api/v1/responseflatteners/",I=n(289),N=n.n(I),E=function(){var e=x().getToken,t=N.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});t.interceptors.request.use((function(t){return e().then((function(e){return e&&t&&t.headers&&(t.headers.Authorization="JWT "+e),t}))}),(function(e){return Promise.reject(e)}));return{axios:t,getCampaigns:function(){return t.get("".concat("api/v1/campaigns/","?limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getChains:function(e){return t.get("".concat(w,"?campaign=").concat(e,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},createChain:function(e){return t.post("".concat(w),e)},getStageNodes:function(e,n){return t.get("".concat(C,"?chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getLogicNodes:function(e,n){return t.get("".concat(k,"?chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getTaskStage:function(e){return t.get("".concat(C+e,"/")).then((function(e){return e.data}))},saveTaskStage:function(e,n){return t.patch("".concat(C+e,"/"),n)},getTaskStageOptions:function(){return t.options("".concat(C)).then((function(e){return e.data}))},getConditionalStage:function(e){return t.get("".concat(k+e,"/")).then((function(e){return e.data}))},saveConditionalStage:function(e,n){return t.patch("".concat(k+e,"/"),n)},getResponseFlattenerList:function(e){return t.get("".concat(_,"?task_stage__chain__campaign=").concat(e)).then((function(e){return e.data})).then((function(e){return e.results}))},getResponseFlattener:function(e){return t.get("".concat(_+e,"/")).then((function(e){return e.data}))},downloadFlattenedResponses:function(e,n){return t.get("".concat("api/v1/tasks/","csv/?stage=").concat(e,"&response_flattener=").concat(n),{responseType:"blob"}).then((function(e){var t=window.URL.createObjectURL(new Blob([e.data])),n=document.createElement("a");n.href=t,n.setAttribute("download","results.csv"),document.body.appendChild(n),n.click()}))},saveResponseFlattener:function(e,n){return t.put("".concat(_+e,"/"),n)},createResponseFlattener:function(e){return t.post("".concat(_),e)}}},T=n(638),F=n(633),D=n(627),L=n(632),R=n(634),B=n(626),A=n(630),P=function(e){var t=e.data,n=e.onClick,a=t.name,c=t.description,r=t.id;return Object(O.jsxs)(A.a,{children:[Object(O.jsxs)(L.a,{sx:{pb:1},children:[Object(O.jsx)(F.a,{variant:"h5",component:"div",children:a}),Object(O.jsxs)(F.a,{gutterBottom:!0,variant:"caption",color:"text.secondary",children:["ID: ",r]}),Object(O.jsx)(F.a,{overflow:"hidden",textOverflow:"ellipsis",variant:"body2",sx:{height:60,maxWidth:500},children:c})]}),Object(O.jsx)(R.a,{children:Object(O.jsx)(B.a,{size:"small",onClick:function(){n(r)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},z=n(7),U=n(24),J=n(636),G=n(612),M=n(290),q=n.n(M),W=n(637),V=n(9),H=n(635),X=["expand"],Y=Object(V.a)((function(e){e.expand;var t=Object(U.a)(e,X);return Object(O.jsx)(H.a,Object(z.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),$=function(e){var t=e.data,n=e.children,c=e.hideExpandButton,r=e.hideOpenButton,i=e.onClick,o=t.name,s=(t.description,t.id),u=Object(a.useState)(!1),l=Object(j.a)(u,2),d=l[0],p=l[1],b=[];return r||b.push(Object(O.jsx)(B.a,{variant:"contained",onClick:function(){i&&i(s)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"},"open_button")),c||b.push(Object(O.jsx)(Y,{expand:d,onClick:function(){p(!d)},"aria-expanded":d,"aria-label":"show more",children:Object(O.jsx)(q.a,{})},"expand_button")),Object(O.jsxs)(A.a,{children:[Object(O.jsx)(J.a,{action:Object(O.jsx)(G.a,{direction:"row",spacing:1,children:b}),title:o,subheader:"ID: ".concat(s),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(O.jsx)(W.a,{in:d,timeout:"auto",unmountOnExit:!0,children:Object(O.jsx)(L.a,{children:n})})]})},K=function(e){var t=e.data,n=e.view,a=e.onSelect;return t?"grid"===n?Object(O.jsx)(D.a,{container:!0,py:2,spacing:{xs:2,md:3},columns:{xs:4,sm:8,md:12},children:t.map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:2,sm:4,md:4,children:Object(O.jsx)(P,{data:e,onClick:a})},t)}))}):"list"===n?Object(O.jsx)(D.a,{container:!0,py:2,spacing:2,children:t.map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:12,children:Object(O.jsx)($,{data:e,hideExpandButton:!0,onClick:a})},t)}))}):null:Object(O.jsx)(F.a,{children:"Error"})},Q=n(622),Z=n(291),ee=n.n(Z),te=n(292),ne=n.n(te),ae=function(e){var t=e.label,n=e.view,a=e.location,c=e.hideCreateButton,r=e.hideViewButton,i=e.onViewChange;return Object(O.jsxs)(D.a,{container:!0,alignItems:"center",spacing:1,children:[Object(O.jsx)(D.a,{item:!0,flex:1,children:Object(O.jsx)(F.a,{hidden:!t,variant:"h4",children:t})}),Object(O.jsx)(D.a,{item:!0,hidden:c,children:Object(O.jsx)(B.a,{component:o.b,to:"new",state:{from:a},variant:"contained",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})}),Object(O.jsxs)(D.a,{item:!0,hidden:r,children:[Object(O.jsx)(Q.a,{title:"\u0421\u0435\u0442\u043a\u0430",children:Object(O.jsx)(H.a,{color:"grid"===n?"primary":"default",onClick:function(){return i("grid")},children:Object(O.jsx)(ee.a,{})})}),Object(O.jsx)(Q.a,{title:"\u0421\u043f\u0438\u0441\u043e\u043a",children:Object(O.jsx)(H.a,{color:"list"===n?"primary":"default",onClick:function(){return i("list")},children:Object(O.jsx)(ne.a,{})})})]})]})},ce=function(e){var t=e.id,n=e.data,c=e.label,r=e.defaultView,i=e.hideCreateButton,o=e.hideViewButton,u=e.onSelect,l=Object(s.h)(),d=Object(a.useState)(null!==r&&void 0!==r?r:"grid"),p=Object(j.a)(d,2),b=p[0],h=p[1];Object(a.useEffect)((function(){if(!r){var e=localStorage.getItem("".concat(t,"_view"))||"grid";e&&h(e)}}),[]);return Object(O.jsxs)(T.a,{children:[Object(O.jsx)(ae,{label:c,view:b,onViewChange:function(e){h(e),localStorage.setItem("".concat(t,"_view"),e)},location:l,hideCreateButton:i,hideViewButton:o}),Object(O.jsx)(K,{data:n,view:b,onSelect:u})]})},re=function(){var e=E().getCampaigns,t=Object(s.i)(),n=Object(a.useState)([]),c=Object(j.a)(n,2),r=c[0],i=c[1];Object(a.useEffect)((function(){e().then((function(e){return i(e)}))}),[]);return Object(O.jsx)(T.a,{px:3,py:1,children:Object(O.jsx)(ce,{id:"campaigns",data:r,hideCreateButton:!0,label:"\u041a\u0430\u043c\u043f\u0430\u043d\u0438\u0438",onSelect:function(e){t("/campaign/".concat(e,"/chain"))}})})},ie=function(){var e,t,n=x().login,a=Object(s.i)(),c=Object(s.h)(),r=(null===c||void 0===c||null===(e=c.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(B.a,{onClick:function(){n((function(){return a(r,{replace:!0})}))},children:"Login"})},oe=n(5),se=n(42),ue=n(628),le=n(643),de=n(639),je=n(642),pe=n(645),be=n(616),he=n(644),fe=n(295),Oe=n.n(fe),me=n(297),ge=n.n(me),xe=n(296),ve=n.n(xe),ye=n(623),Se=n(640),we=n(641),Ce=n(293),ke=n.n(Ce),_e=n(294),Ie=n.n(_e),Ne=240,Ee=function(e){return{width:Ne,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},Te=function(e){return Object(oe.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.down("sm"),{width:0})},Fe=Object(V.a)("div")((function(e){var t=e.theme;return Object(z.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),De=Object(V.a)(de.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:Ne,width:"calc(100% - ".concat(Ne,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),Le=Object(V.a)(ue.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)(Object(z.a)({width:Ne,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(z.a)(Object(z.a)({},Ee(t)),{},{"& .MuiDrawer-paper":Ee(t)})),!n&&Object(z.a)(Object(z.a)({},Te(t)),{},{"& .MuiDrawer-paper":Te(t)}))}));function Re(e){var t=Object(se.a)(),n=Object(s.j)().campaignId,a=Object(s.i)(),r=x().logout,i=c.a.useState(!1),u=Object(j.a)(i,2),l=u[0],d=u[1],p=e.children,b=[{page:"chain",title:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",icon:Object(O.jsx)(ke.a,{})},{page:"flattener",title:"Flattener",icon:Object(O.jsx)(Ie.a,{})}];return Object(O.jsxs)(T.a,{sx:{display:"flex"},children:[Object(O.jsx)(be.a,{}),Object(O.jsx)(De,{position:"fixed",open:l,children:Object(O.jsxs)(je.a,{children:[n&&Object(O.jsx)(H.a,{color:"inherit","aria-label":"open drawer",onClick:function(){d(!0)},edge:"start",sx:Object(z.a)({marginRight:"36px"},l&&{display:"none"}),children:Object(O.jsx)(Oe.a,{})}),Object(O.jsx)(T.a,{sx:{flexGrow:1},children:Object(O.jsx)(le.a,{component:o.b,color:"inherit",underline:"none",variant:"h6",noWrap:!0,to:"/",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"GigaTurnip Admin Interface"})}),Object(O.jsx)(B.a,{color:"inherit",onClick:function(){return r((function(){return a("/")}))},children:"\u0412\u044b\u0445\u043e\u0434"})]})}),n&&Object(O.jsxs)(Le,{variant:"permanent",open:l,children:[Object(O.jsx)(Fe,{children:Object(O.jsx)(H.a,{onClick:function(){d(!1)},children:"rtl"===t.direction?Object(O.jsx)(ve.a,{}):Object(O.jsx)(ge.a,{})})}),Object(O.jsx)(he.a,{}),Object(O.jsx)(pe.a,{children:b.map((function(e,t){return Object(O.jsxs)(ye.a,{component:o.b,to:"campaign/".concat(n,"/").concat(e.page),children:[Object(O.jsx)(Se.a,{children:e.icon}),Object(O.jsx)(we.a,{primary:e.title})]},t)}))})]}),Object(O.jsxs)(T.a,{component:"main",sx:{flexGrow:1,width:"100%"},children:[Object(O.jsx)(Fe,{}),p]})]})}var Be=function(){return Object(O.jsx)("div",{children:Object(O.jsx)(Re,{children:Object(O.jsx)(s.b,{})})})},Ae=function(){var e=E().getChains,t=Object(s.i)(),n=Object(s.j)().campaignId,c=Object(a.useState)([]),r=Object(j.a)(c,2),i=r[0],o=r[1];Object(a.useEffect)((function(){if(n){var t=parseInt(n);e(t).then((function(e){return o(e)}))}}),[]);return Object(O.jsx)(T.a,{px:3,py:1,children:Object(O.jsx)(ce,{id:"chains",data:i,label:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",onSelect:function(e){t("".concat(e))}})})},Pe=n(25),ze=n(62),Ue=Object(V.a)(T.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius}})),Je=function(e){var t=e.data,n=e.type;return Object(O.jsxs)(Ue,{type:n,children:[Object(O.jsx)(F.a,{children:t.label}),Object(O.jsx)(ze.b,{type:"target",position:ze.c.Top,style:{borderRadius:"100%",width:10,height:10}}),Object(O.jsx)(ze.b,{type:"source",position:ze.c.Bottom,style:{borderRadius:"100%",width:10,height:10}})]})},Ge=Object(V.a)(Je)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main}})),Me=function(e){var t=e.data;return Object(O.jsx)(Ge,{data:t,type:"logic"})},qe=Object(V.a)(Je)((function(e){var t=e.theme;return{color:t.palette.success.contrastText,backgroundColor:t.palette.success.main}})),We=function(e){var t=e.data;return Object(O.jsx)(qe,{data:t,type:"stage"})},Ve=(n(367),n(203)),He=n(119),Xe=n.n(He),Ye=n(157),$e=n.n(Ye),Ke=function(){var e=E().axios,t=function(e,t){return t.filter((function(t){return parseInt(t.id)===e})).pop()},n=function(e){return"STAGE"===e.type?C:"LOGIC"===e.type?k:void 0},a=function(){var t=Object(d.a)(l.a.mark((function t(a){var c,r,i,o,s,u,d,j,p,b;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c=a.node,r=a.currentNodeId,i=a.type,o=a.method,!(s=n(c))){t.next=21;break}return u=void 0,t.next=6,e.get("".concat(s+c.id,"/"));case 6:if(d=t.sent,j=d.data,"in"===i&&(u=j.in_stages),"out"===i&&(u=j.out_stages),!u){t.next=21;break}if(p=[],"create"===o&&(p=[r].concat(Object(Pe.a)(u))),"delete"===o&&(p=u.filter((function(e){return e!==r}))),b=void 0,"in"===i&&(b={in_stages:p}),"out"===i&&(b={out_stages:p}),!b){t.next=21;break}return console.log(b),t.next=21,e.patch("".concat(s+c.id,"/"),b);case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(e,n,c){var r=t(e,c),i=t(n,c);r&&a({node:r,currentNodeId:n,type:"in",method:"delete"}),i&&a({node:i,currentNodeId:e,type:"out",method:"delete"})},r=function(){var t=Object(d.a)(l.a.mark((function t(a,c){var r,i,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r={name:a.label,x_pos:Math.round(a.position.x),y_pos:Math.round(a.position.y),chain:c,out_stages:[]},!(i=n(a))){t.next=7;break}return t.next=5,e.post(i,r).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 5:return o=t.sent,t.abrupt("return",o.id.toString());case 7:return t.abrupt("return",void 0);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{getFormFields:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(Ve.B)(e),a=Object(Ve.G)(n,"",e,t),c=function(e,t){return function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""];return Object.keys(n).forEach((function(r){if("object"===typeof n[r]){var i=c.map((function(e){return"".concat(e,".").concat(r)}));n[r].__rjsf_additionalProperties&&""!==n[r].$name?a.push(n[r].$name):e(n[r],a,i)}else"$name"===r&&""!==n[r]&&c.forEach((function(e){e=e.replace(/^\./,"");var n=Xe()(t,e);("object"!==typeof n||$e()(n))&&a.push(e)}))})),a}(e)};return c(a,t)},parseId:function(e){if(e)return parseInt(e);throw new Error("No id")},getNode:t,getUrl:n,updateConnections:a,addConnections:function(e,n,c){var r=t(e,c),i=t(n,c);r&&a({node:r,currentNodeId:n,type:"in",method:"create"}),i&&a({node:i,currentNodeId:e,type:"out",method:"create"})},removeConnections:c,removeElements:function(t,a){var r=t.map((function(e){return e.id}));return a.filter((function(t){if(r.includes(t.id)){if(Object(ze.f)(t)){var i=parseInt(t.target),o=parseInt(t.source);c(i,o,a)}else{var s=n(t);s&&e.delete(s+t.id+"/")}return!1}return!0}))},updateNode:function(t){var a={x_pos:Math.round(t.position.x),y_pos:Math.round(t.position.y)},c=n(t);console.log(a),c&&e.patch(c+t.id+"/",a).then((function(e){return console.log(e.data)}))},createNode:r}},Qe=n(618),Ze=Object(V.a)(T.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius,cursor:"grab",margin:8}})),et=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],c=t[1],r=Object(a.useState)(""),i=Object(j.a)(r,2),o=i[0],s=i[1];Object(a.useEffect)((function(){c(!(!o||""===o))}),[o]);var u=function(e,t,n){var a=JSON.stringify({label:o,type:n});e.dataTransfer.setData("application/reactflow",a),e.dataTransfer.effectAllowed="move"},l=function(){s("")};return Object(O.jsxs)(D.a,{item:!0,container:!0,justifyContent:"center",px:1,children:[Object(O.jsxs)(D.a,{container:!0,item:!0,mt:2,justifyContent:"center",children:[Object(O.jsx)(Qe.a,{label:"Label",size:"small",value:o,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)(F.a,{py:1,variant:"caption",color:"red",align:"center",children:!n&&"Enter label to drag the node"})]}),Object(O.jsxs)(D.a,{item:!0,children:[Object(O.jsx)(Ze,{type:"stage",onDragEnd:l,onDragStart:function(e){return u(e,0,"STAGE")},draggable:n,children:"Taskstage Node"}),Object(O.jsx)(Ze,{type:"logic",onDragEnd:l,onDragStart:function(e){return u(e,0,"LOGIC")},draggable:n,children:"Conditional Node"})]})]})},tt=function(){var e=Object(a.useRef)(null),t=E(),n=t.getStageNodes,c=t.getLogicNodes,r=Ke(),i=r.parseId,o=r.addConnections,u=r.createNode,p=r.removeElements,b=r.updateNode,h=Object(s.j)(),f=h.campaignId,m=h.chainId,g=Object(a.useState)(null),x=Object(j.a)(g,2),v=x[0],y=x[1],S=Object(a.useState)([]),w=Object(j.a)(S,2),C=w[0],k=w[1],_=Object(s.i)(),I=i(f),N=i(m),T={style:{strokeWidth:3},arrowHeadType:"arrow"};Object(a.useEffect)((function(){Promise.all([n(I,N),c(I,N)]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){return e.type="STAGE"})),n.forEach((function(e){return e.type="LOGIC"}));var a=[].concat(Object(Pe.a)(t),Object(Pe.a)(n)),c=a.map((function(e){return{id:e.id.toString(),position:{x:parseFloat(e.x_pos),y:parseFloat(e.y_pos)},data:{label:e.name},type:e.type}}));return k(c),a})).then((function(e){e.forEach((function(e){e.in_stages.length>0&&e.in_stages.forEach((function(t){var n=Object(z.a)({source:t.toString(),target:e.id.toString(),id:"".concat(t,"-").concat(e.id)},T);k((function(e){return Object(ze.d)(n,e)}))}))}))}))}),[N]);var F=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(z.a)(Object(z.a)({},t),T),a=parseInt(n.target),c=parseInt(n.source),k((function(e){return Object(ze.d)(n,e)})),o(a,c,C);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var t=Object(d.a)(l.a.mark((function t(n){var a,c,r,i,o,s,d,j;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),a=e.current.getBoundingClientRect(),c=n.dataTransfer.getData("application/reactflow"),r=v.project({x:n.clientX-a.left,y:n.clientY-a.top}),i=JSON.parse(c),o=i.label,s=i.type,""!==o){t.next=9;break}return t.abrupt("return",0);case 9:return t.next=11,u({type:s,position:r,label:o},N);case 11:d=t.sent,j={id:d,type:s,position:r,data:{label:o}},k((function(e){return[].concat(Object(Pe.a)(e),[j])}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),R=function(e,t){console.log(t),t.id&&("LOGIC"===t.type&&_("createlogic/".concat(t.id)),"STAGE"===t.type&&_("createstage/".concat(t.id)))},B={LOGIC:Me,STAGE:We};return Object(O.jsxs)(D.a,{container:!0,children:[Object(O.jsx)(D.a,{item:!0,md:10,zIndex:1,children:Object(O.jsx)(ze.e,{ref:e,nodeTypes:B,elements:C,onConnect:F,onElementsRemove:function(e){k((function(t){return p(e,t)}))},onNodeDoubleClick:R,onEdgeDoubleClick:R,onLoad:function(e){return y(e)},onDrop:L,onDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"},onNodeDragStop:function(e,t){b(t)},preventScrolling:!0,style:{width:"94vw",height:"90vh"},children:Object(O.jsx)(ze.a,{})})}),Object(O.jsx)(D.a,{item:!0,md:2,zIndex:2,height:200,sx:{background:"white"},children:Object(O.jsx)(et,{})})]})},nt=n(298),at=n.n(nt),ct=Object(V.a)(H.a)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.dark}}})),rt=function(e){var t=e.mode,n=e.allModes,a=e.onChange,c=e.onBack;return Object(O.jsxs)(T.a,{display:"flex",justifyContent:"flex-end",sx:{position:"sticky",top:60},p:1,zIndex:1,children:[Object(O.jsx)(T.a,{flex:1,children:Object(O.jsx)(Q.a,{title:"\u041d\u0430\u0437\u0430\u0434",children:Object(O.jsx)(ct,{onClick:c,children:Object(O.jsx)(at.a,{fontSize:"large"})})})}),Object(O.jsx)(G.a,{direction:"row",spacing:1,children:Object.keys(n).map((function(e){var c=t===e?"primary":"default",r=n[e].title,i=n[e].icon;return Object(O.jsx)(T.a,{children:Object(O.jsx)(Q.a,{title:r,children:Object(O.jsx)(H.a,{color:c,onClick:function(){return a(e)},children:i})})},e)}))})]})},it=function(e){e.id,e.schema,e.options,e.value,e.required,e.disabled,e.readonly,e.label,e.onChange,e.onBlur,e.onFocus;return Object(O.jsx)("p",{children:"\u0417\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 \u0430\u0443\u0434\u0438\u043e"})},ot=n(26),st=function(e){var t=e.id,n=e.placeholder,a=e.required,c=e.readonly,r=e.disabled,i=e.label,o=e.value,s=e.onChange,u=e.onBlur,l=e.onFocus,d=e.autofocus,j=e.options,p=e.schema,b=e.rawErrors,h=void 0===b?[]:b,f="string"===p.type?"text":"".concat(p.type);return Object(O.jsxs)(ot.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ot.a.Label,{className:h.length>0?"text-danger":"",children:[i||p.title,(i||p.title)&&a?"*":null]}),Object(O.jsx)(ot.a.Control,{id:t,placeholder:n,autoFocus:d,required:a,disabled:r,readOnly:c,className:h.length>0?"is-invalid":"",list:p.examples?"examples_".concat(t):void 0,type:f,value:o||0===o?o:"",onChange:function(e){var t=e.target.value;return s(""===t?j.emptyValue:t)},onBlur:function(e){var n=e.target.value;return u(t,n)},onFocus:function(e){var n=e.target.value;return l(t,n)}}),p.examples?Object(O.jsx)("datalist",{id:"examples_".concat(t),children:p.examples.concat(p.default?[p.default]:[]).map((function(e){return Object(O.jsx)("option",{value:e},e)}))}):null]})},ut=function(e){var t=e.required,n=e.label,a=e.value,c=e.schema,r=e.rawErrors,i=void 0===r?[]:r;return a?Object(O.jsxs)(ot.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ot.a.Label,{className:i.length>0?"text-danger":"",children:[n||c.title,(n||c.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsx)("a",{href:a,children:a})]}):null},lt=function(e){var t=e.id,n=e.schema,a=e.options,c=e.value,r=e.required,i=e.disabled,o=e.readonly,s=e.label,u=e.onChange,l=e.onBlur,d=e.onFocus,j=a.enumOptions,p=a.enumDisabled,b=function(e){var t=e.target.value;return u("boolean"==n.type?"false"!==t:t)},h=function(e){var n=e.target.value;return l(t,n)},f=function(e){var n=e.target.value;return d(t,n)},m=Boolean(a&&a.inline);return Object(O.jsxs)(ot.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ot.a.Label,{className:"d-block",children:[s||n.title,(s||n.title)&&r?"*":null]}),j.map((function(e,n){var a=Array.isArray(p)&&-1!==p.indexOf(e.value),s=e.value==c;return Object(O.jsx)(ot.a.Check,{inline:m,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:i||a||o,checked:s,required:r,value:e.value,onChange:b,onBlur:h,onFocus:f},n)}))]})},dt=function(e){var t=e.required,n=e.label,a=e.formData,c=e.schema,r=e.onChange,i=e.rawErrors,o=void 0===i?[]:i,s=function(e){var t=Array.isArray(a)?a:[];if("add"===e){var n=[].concat(Object(Pe.a)(t),[(new Date).toISOString()]);r(n)}else if("remove"===e){var c=Object(Pe.a)(t);c.pop(),r(c)}};return Object(O.jsxs)(ot.a.Group,{className:"mb-0",children:[Object(O.jsxs)(ot.a.Label,{className:o.length>0?"text-danger":"",children:[n||c.title,(n||c.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsxs)(T.a,{display:"flex",height:80,children:[Object(O.jsx)(F.a,{variant:"h2",pr:1,children:Array.isArray(a)?a.length:0}),Object(O.jsx)(B.a,{fullWidth:!0,variant:"contained",onClick:function(){return s("add")},children:"+"}),Object(O.jsx)(B.a,{variant:"contained",color:"warning",onClick:function(){return s("remove")},children:"-"})]})]})},jt=n(313),pt=(n(283),function(e){var t=e.schema,n=e.uiSchema,a=e.formData,c=e.hideButton,r=e.onChange,i=e.onSubmit,o={customfile:it,autocomplete:st,RadioWidget:lt,customlink:ut,audio:it},s={counter:dt};return Object(O.jsx)(jt.a,{schema:t,uiSchema:n,formData:a,widgets:o,fields:s,onChange:function(e){if(!r)return 0;r(e.formData)},onSubmit:function(e){if(!i)return 0;i(e.formData)},children:c?" ":Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})}),bt=n(300),ht=n(20),ft={audio:{displayName:"Audio",matchIf:[{types:["string"],widget:"audio"}],possibleOptions:["private","default"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"audio","ui:options":{private:!1,default:""}},type:"string",cardBody:function(e){var t,n,a,c=e.parameters,r=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=c["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return r(Object(z.a)(Object(z.a)({},c),{},{"ui:options":Object(z.a)(Object(z.a)({},c["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsx)("h5",{children:"Default Audio (Link)"}),Object(O.jsx)(ht.f,{value:null!==(n=null===(a=c["ui:options"])||void 0===a?void 0:a.default)&&void 0!==n?n:"",placeholder:"Default",type:"text",onChange:function(e){return r(Object(z.a)(Object(z.a)({},c),{},{"ui:options":Object(z.a)(Object(z.a)({},c["ui:options"]),{},{default:e.target.value})}))},className:"card-text"})]})}}},Ot={autocomplete:{displayName:"AutoComplete",matchIf:[{types:["string"],widget:"autocomplete"}],possibleOptions:["webhook","params","searchField","responseField"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"autocomplete","ui:options":{webhook:"",params:"",searchField:"",responseField:""}},type:"string",cardBody:function(e){var t,n,a,r,i=e.parameters,o=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Webhook"}),Object(O.jsx)(ht.f,{value:null===(t=i["ui:options"])||void 0===t?void 0:t.webhook,placeholder:"Webhook",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{webhook:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)("h5",{children:"Params"}),Object(O.jsx)(ht.f,{value:null===(n=i["ui:options"])||void 0===n?void 0:n.params,placeholder:"Params",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{params:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{width:"100%",paddingRight:7},children:[Object(O.jsx)("h5",{children:"Search Field"}),Object(O.jsx)(ht.f,{value:null===(a=i["ui:options"])||void 0===a?void 0:a.searchField,placeholder:"Search Field",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{searchField:e.target.value})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{width:"100%",paddingLeft:7},children:[Object(O.jsx)("h5",{children:"Response Field"}),Object(O.jsx)(ht.f,{value:null===(r=i["ui:options"])||void 0===r?void 0:r.responseField,placeholder:"Response Field",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{responseField:e.target.value})}))},className:"card-text"})]})]})]})}}},mt={file:{displayName:"File",matchIf:[{types:["string"],widget:"customfile"}],possibleOptions:["private","multiple"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customfile","ui:options":{private:!1,multiple:!1}},type:"string",cardBody:function(e){var t,n,a=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=a["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return c(Object(z.a)(Object(z.a)({},a),{},{"ui:options":Object(z.a)(Object(z.a)({},a["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Multiple Files"}),Object(O.jsx)("input",{checked:null===(n=a["ui:options"])||void 0===n?void 0:n.multiple,type:"checkbox",onChange:function(e){return c(Object(z.a)(Object(z.a)({},a),{},{"ui:options":Object(z.a)(Object(z.a)({},a["ui:options"]),{},{multiple:e.target.checked})}))},className:"card-text"})]})]})}}},gt={link:{displayName:"Link",matchIf:[{types:["string"],widget:"customlink"}],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customlink"},type:"string",cardBody:function(e){var t,n=e.parameters,a=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(ht.f,{value:null!==(t=n.default)&&void 0!==t?t:"",placeholder:"Default",type:"text",onChange:function(e){return a(Object(z.a)(Object(z.a)({},n),{},{default:e.target.value}))},className:"card-text"})]})}}},xt={counter:{displayName:"Counter",matchIf:[{types:["array"],field:"counter"}],defaultDataSchema:{items:{type:"string",format:"date-time"}},defaultUiSchema:{"ui:field":"counter"},type:"array"}};var vt={longAnswer:{displayName:"Long Answer",matchIf:[{types:["string"],widget:"textarea"}],possibleOptions:["rows"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"textarea"},type:"string",cardBody:function(e){var t=e.parameters,n=e.onChange;return Object(O.jsxs)(c.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(ht.f,{value:t.default,placeholder:"Default",type:"textarea",onChange:function(e){return n(Object(z.a)(Object(z.a)({},t),{},{default:e.target.value}))},className:"card-textarea"})]})},modalBody:function(e){var t,n,a=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsx)("h4",{children:"Minimum Length"}),Object(O.jsx)(ht.f,{value:a.minLength?a.minLength:"",placeholder:"Minimum Length",type:"number",onChange:function(e){c(Object(z.a)(Object(z.a)({},a),{},{minLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"minLength"),Object(O.jsx)("h4",{children:"Maximum Length"}),Object(O.jsx)(ht.f,{value:a.maxLength?a.maxLength:"",placeholder:"Maximum Length",type:"number",onChange:function(e){c(Object(z.a)(Object(z.a)({},a),{},{maxLength:parseInt(e.target.value,10)}))},className:"card-modal-number"},"maxLength"),Object(O.jsx)("h4",{children:"Rows"}),Object(O.jsx)(ht.f,{value:null!==(t=null===(n=a["ui:options"])||void 0===n?void 0:n.rows)&&void 0!==t?t:0,placeholder:"Rows",type:"number",onChange:function(e){c(Object(z.a)(Object(z.a)({},a),{},{"ui:options":{rows:parseInt(e.target.value,10)}}))},className:"card-modal-number"},"rows"),Object(O.jsxs)("h4",{children:["Regular Expression Pattern"," ",Object(O.jsx)("a",{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"})]}),Object(O.jsx)(ht.f,{value:a.pattern?a.pattern:"",placeholder:"Regular Expression Pattern",type:"text",onChange:function(e){c(Object(z.a)(Object(z.a)({},a),{},{pattern:e.target.value}))},className:"card-modal-text"},"pattern"),Object(O.jsxs)("div",{className:"card-modal-boolean",children:[Object(O.jsx)("p",{children:"Auto Focus"}),Object(O.jsx)("input",{type:"checkbox",onChange:function(){c(Object(z.a)(Object(z.a)({},a),{},{"ui:autofocus":!a["ui:autofocus"]||!0!==a["ui:autofocus"]}))},checked:!!a["ui:autofocus"]&&!0===a["ui:autofocus"]})]})]})}}},yt=n(314),St=function(e){var t=e.schema,n=e.uiSchema,a=e.onChange,c=Object(z.a)(Object(z.a)(Object(z.a)(Object(z.a)(Object(z.a)(Object(z.a)({},mt),Ot),gt),ft),xt),vt);return Object(O.jsx)(yt.a,{schema:t,uischema:n,onChange:function(e,t){a(e,t)},mods:{customFormInputs:c}})},wt=Object(V.a)(T.a)((function(){return{width:"70%",minWidth:"400px",margin:"0 auto"}})),Ct=function(e){var t=e.schema,n=e.uiSchema,a=e.formData,c=e.onSchemaChange,r=e.onFormDataChange,i=Object(z.a)({},bt);return Object(O.jsxs)(T.a,{p:1,children:[Object(O.jsx)(St,{schema:t,uiSchema:n,onChange:c}),Object(O.jsx)(wt,{children:Object(O.jsx)(pt,{schema:i,uiSchema:{displayed_prev_stages:{"ui:widget":"checkboxes"}},formData:a,onChange:r,hideButton:!0})})]})},kt=n(160),_t=function(e){var t=e.data;return Object(O.jsx)(kt.a,{id:"ViewerTinyMCE",value:t,toolbar:!1,inline:!1,disabled:!0,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autoresize",menubar:!1,image_advtab:!0,importcss_append:!0}})},It=function(e){var t=e.schema,n=e.uiSchema,a=e.text;return Object(O.jsxs)(wt,{children:[a&&Object(O.jsx)(_t,{data:a}),Object(O.jsx)(T.a,{py:1,children:Object(O.jsx)(pt,{schema:t,uiSchema:n})})]})},Nt=n(646),Et=n(647),Tt=n(648),Ft=function(e){var t=e.isEditable,n=e.schema,a=e.ui,c=e.onSchemaChange,r=e.onUiChange,i=e.onIsEditableChange,o=e.onSave,s=e.onUndo,u=n,l=a;try{var d=JSON.parse(n);u=JSON.stringify(d,null,2);var j=JSON.parse(a);l=JSON.stringify(j,null,2)}catch(p){console.log(p)}return Object(O.jsxs)(T.a,{children:[Object(O.jsxs)(D.a,{container:!0,alignItems:"center",children:[Object(O.jsx)(Nt.a,{sx:{my:1},children:Object(O.jsx)(Et.a,{control:Object(O.jsx)(Tt.a,{checked:t,onChange:function(){i()},name:"edit",inputProps:{"aria-label":"edit"}}),labelPlacement:"start",label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})}),t&&Object(O.jsx)(B.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){o()},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"}),t&&Object(O.jsx)(B.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){s()},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"})]}),Object(O.jsxs)(D.a,{container:!0,children:[Object(O.jsx)(D.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(Qe.a,{label:"Schema",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:u,onChange:function(e){c(e.target.value)},style:{marginTop:15,marginBottom:15}})}),Object(O.jsx)(D.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(Qe.a,{label:"Ui",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:l,onChange:function(e){r(e.target.value)},style:{marginTop:15,marginBottom:30}})})]})]})},Dt=n(303),Lt=function(e){var t=e.id,n=E().getTaskStageOptions,c=Object(a.useState)({}),r=Object(j.a)(c,2),i=r[0],o=r[1],s=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t.actions.POST);case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(e){var t=["string","number","integer","boolean","null"],n=e?Object.keys(e):[],a={},c=[];n.forEach((function(n){var r=e[n],i=r.type,o=r.label,s=r.help_text,u=r.required;t.includes(i)?(a[n]={type:i,title:o,description:s},u&&c.push(n)):"decimal"===i&&(a[n]={type:"number",title:o,description:s},u&&c.push(n))}));var r={type:"object",properties:a,required:c};return console.log(r),r};return Object(a.useEffect)((function(){t&&function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:t=e.sent,n=u(t),o(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(O.jsx)("div",{children:Object(O.jsx)(pt,{schema:i})})},Rt=function(e){Object(Dt.a)(e);return Object(O.jsx)(wt,{children:Object(O.jsx)(D.a,{container:!0,py:2,spacing:2,children:[1,2].map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:12,children:Object(O.jsx)($,{data:{name:e},hideOpenButton:!0,children:Object(O.jsx)(Lt,{id:e})})},t)}))})})},Bt=(n(557),function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(kt.a,{id:"EditorTinyMCE",onEditorChange:function(e,t){n(e)},value:t,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autosave save print preview paste importcss searchreplace autolink directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap emoticons autoresize",menubar:"file edit view insert format tools table help",toolbar:"undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media link anchor codesample | ltr rtl",toolbar_sticky:!0,image_advtab:!0,importcss_append:!0,image_caption:!0,noneditable_noneditable_class:"mceNonEditable",toolbar_mode:"sliding",contextmenu:"link image imagetools table",autosave_prefix:"tinymce-autosave-{path}{query}-",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})}),At=function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(wt,{children:Object(O.jsx)(Bt,{data:t,onChange:n})})},Pt=n(621),zt=n(624),Ut=c.a.createContext(null),Jt=c.a.forwardRef((function(e,t){return Object(O.jsx)(Pt.a,Object(z.a)({elevation:6,ref:t,variant:"filled"},e))})),Gt=function(e){var t=e.children,n=Object(a.useState)(!1),c=Object(j.a)(n,2),r=c[0],i=c[1],o=Object(a.useState)(""),s=Object(j.a)(o,2),u=s[0],l=s[1],d=Object(a.useState)("error"),p=Object(j.a)(d,2),b=p[0],h=p[1],f=function(e,t){"clickaway"!==t&&i(!1)},m={open:r,openToast:function(e,t){t&&h(t),l(function(e){switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return String(e)}}(e)),i(!0)},closeToast:f};return Object(O.jsxs)(Ut.Provider,{value:m,children:[Object(O.jsx)(zt.a,{open:r,autoHideDuration:5e3,onClose:f,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(O.jsx)(Jt,{onClose:f,severity:b,sx:{width:"100%"},children:u})}),t]})},Mt=function(){return c.a.useContext(Ut)},qt=n(305),Wt=n.n(qt),Vt=n(307),Ht=n.n(Vt),Xt=n(308),Yt=n.n(Xt),$t=n(309),Kt=n.n($t),Qt=n(304),Zt=n.n(Qt);function en(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Object(a.useContext)(s.f),c=n.navigator;Object(a.useEffect)((function(){if(t){var n=c.block((function(t){var a=Object(z.a)(Object(z.a)({},t),{},{retry:function(){n(),setTimeout((function(){return t.retry()}),100)}});e(a)}));return n}}),[c,e,t])}var tn=function(e){var t=e.schema,n=e.uiSchema,a=e.onSchemaChange,c=e.onUseMainSchema;return Object(O.jsxs)(T.a,{p:1,children:[Object(O.jsx)(T.a,{display:"flex",justifyContent:"center",children:Object(O.jsx)(B.a,{variant:"contained",onClick:c,children:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0433\u043b\u0430\u0432\u043d\u0443\u044e \u0441\u0445\u0435\u043c\u0443"})}),Object(O.jsx)(St,{schema:t,uiSchema:n,onChange:a})]})},nn=n(306),an=n.n(nn),cn=["id","json_schema","ui_schema","rich_text","webhook_address","webhook_params","card_json_schema","card_ui_schema"],rn=["chain","webhook_params"],on=function(){var e=Object(s.j)().stageId,t=Object(s.i)(),n=E(),c=n.getTaskStage,r=n.saveTaskStage,i=(0,Ke().parseId)(e),o=Mt().openToast,u=Object(a.useState)(""),p=Object(j.a)(u,2),b=p[0],h=p[1],f=Object(a.useState)(""),m=Object(j.a)(f,2),g=m[0],x=m[1],v=Object(a.useState)({}),y=Object(j.a)(v,2),S=y[0],w=y[1],C=Object(a.useState)("builder"),k=Object(j.a)(C,2),_=k[0],I=k[1],N=Object(a.useState)(""),F=Object(j.a)(N,2),D=F[0],L=F[1],R=Object(a.useState)(!1),A=Object(j.a)(R,2),P=A[0],J=A[1],G=Object(a.useState)(""),M=Object(j.a)(G,2),q=M[0],W=M[1],V=Object(a.useState)(""),H=Object(j.a)(V,2),X=H[0],Y=H[1],$=Object(a.useState)(""),K=Object(j.a)($,2),Q=K[0],Z=K[1],ee=Object(a.useState)(""),te=Object(j.a)(ee,2),ne=te[0],ae=te[1],ce=Object(a.useState)(!1),re=Object(j.a)(ce,2),ie=re[0],oe=re[1],se=Object(a.useState)(""),ue=Object(j.a)(se,2),le=ue[0],de=ue[1],je=Object(a.useState)(""),pe=Object(j.a)(je,2),be=pe[0],he=pe[1];!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];en(Object(a.useCallback)((function(t){var n;"function"===typeof e?"string"===typeof(n=e(t.location,t.action))&&(n=window.confirm(n)):n=window.confirm(e),n&&t.retry()}),[e]),t)}("\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b, \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u043f\u043e\u043a\u0438\u043d\u0443\u0442\u044c \u044d\u0442\u0443 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0443?",ie);var fe=b?JSON.parse(b):{},Oe=g?JSON.parse(g):{},me={builder:{title:"\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440",icon:Object(O.jsx)(Wt.a,{fontSize:"large"})},card:{title:"Card Data",icon:Object(O.jsx)(an.a,{fontSize:"large"})},text:{title:"\u0422\u0435\u043a\u0441\u0442",icon:Object(O.jsx)(Ht.a,{fontSize:"large"})},preview:{title:"\u041f\u0440\u0435\u0432\u044c\u044e",icon:Object(O.jsx)(Yt.a,{fontSize:"large"})},editor:{title:"\u0421\u0445\u0435\u043c\u044b",icon:Object(O.jsx)(Kt.a,{fontSize:"large"})}};Object(a.useEffect)((function(){i&&function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r,i,o,s,u,d,j;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t);case 2:n=e.sent,n.id,a=n.json_schema,r=n.ui_schema,i=n.rich_text,o=n.webhook_address,s=n.webhook_params,u=n.card_json_schema,d=n.card_ui_schema,(j=Object(U.a)(n,cn)).webhook_address=o||void 0,j.webhook_params=s?JSON.stringify(s):void 0,h(a),x(r),W(a),Y(r),Z(a),ae(r),w(j),L(i),de(u),he(d);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(i)}),[i]);var ge=Object(a.useCallback)((function(){S.chain;var e,t=S.webhook_params,n=Object(U.a)(S,rn);try{e=JSON.parse(t)}catch(a){e=null}return Object(z.a)(Object(z.a)({},n),{},{json_schema:b,ui_schema:g,rich_text:D,card_json_schema:le,card_ui_schema:be,webhook_params:e})}),[S,b,D,g,le,be]),xe=function(e){return r(i,e)},ve=Object(a.useCallback)(Zt()((function(e){xe(e).then((function(){return console.log("saved")})).catch((function(e){return o(e.message,"error")}))}),2e3),[]);Object(a.useEffect)((function(){oe(!0)}),[S,b,g,D,ve,ge]);var ye=function(e,t){h(e),x(t),Z(e),ae(t),W(e),Y(t)},Se=function(e,t){de(e),he(t)},we=function(e){w(e)},Ce=function(e){L(e)},ke=function(){J(!P)},_e=function(e){W(e)},Ie=function(e){Y(e)},Ne=function(){h(q),x(X)},Ee=function(){h(Q),x(ne),W(Q),Y(ne)},Te=function(){de(b),he(g)};return Object(O.jsxs)(T.a,{children:[Object(O.jsx)(rt,{allModes:me,mode:_,onChange:function(e){I(e)},onBack:function(){t(-1)}}),function(e){switch(e){case"builder":return Object(O.jsx)(Ct,{schema:b,uiSchema:g,formData:S,onSchemaChange:ye,onFormDataChange:we});case"plugins":return Object(O.jsx)(Rt,{});case"text":return Object(O.jsx)(At,{data:D,onChange:Ce});case"preview":return Object(O.jsx)(It,{schema:fe,uiSchema:Oe,text:D});case"editor":return Object(O.jsx)(Ft,{isEditable:P,schema:q,ui:X,onSchemaChange:_e,onUiChange:Ie,onIsEditableChange:ke,onSave:Ne,onUndo:Ee});case"card":return Object(O.jsx)(tn,{schema:le,uiSchema:be,onSchemaChange:Se,onUseMainSchema:Te})}}(_),Object(O.jsx)(wt,{pb:3,children:Object(O.jsx)(B.a,{variant:"contained",color:"warning",fullWidth:!0,onClick:function(){var e=ge();xe(e).then((function(){return o("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")})).catch((function(e){return o(e.message,"error")})),oe(!1)},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})},sn=n(625),un=function(){var e=E(),t=e.getConditionalStage,n=e.saveConditionalStage,c=e.getTaskStage,r=Object(s.j)().stageId,i=Ke(),o=i.parseId,u=i.getFormFields,p=o(r),b=Mt().openToast,h=Object(a.useState)({}),f=Object(j.a)(h,2),m=f[0],g=f[1],x=Object(a.useState)({}),v=Object(j.a)(x,2),y=v[0],S=v[1],w=Object(a.useState)(!1),C=Object(j.a)(w,2),k=C[0],_=C[1],I=Object(a.useState)(),N=Object(j.a)(I,2),T=N[0],F=N[1],D=Object(a.useState)(!1),L=Object(j.a)(D,2),R=L[0],B=L[1],A=Object(a.useState)([]),P=Object(j.a)(A,2),U=P[0],J=P[1];Object(a.useEffect)((function(){t(p).then((function(e){S(e.conditions),_(e.pingpong)}))}),[p]),Object(a.useEffect)((function(){var e=function(e){if(e){var n=c(e);return n||t(e)}return t(p)};p&&function(){var t=Object(d.a)(l.a.mark((function t(){var n,a,c;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent,!(a=k?n.out_stages:n.in_stages)){t.next=9;break}return t.next=7,Promise.all(a.map(function(){var t=Object(d.a)(l.a.mark((function t(n){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return a=t.sent,t.abrupt("return",Object(oe.a)({},n,a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 7:c=t.sent,Object.keys(c).length>0&&(F(c),B(!0));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[p,k]),Object(a.useEffect)((function(){if(T&&T.length>0){var e=T.map((function(e){var t=Object.values(e)[0],n=t.json_schema?JSON.parse(t.json_schema):{},a={};n&&n.dependencies&&Object.keys(n.dependencies).length>0&&(a=n.dependencies);var c=Object.values(a),r=u(n),i=[];return c.length>0&&(i=c.map((function(e){return function(e){var t=null;return e.hasOwnProperty("oneOf")&&(t=e.oneOf),e.hasOwnProperty("allOf")&&(t=e.allOf),t?t.map((function(e){var t=Object(z.a)({type:"object"},e);return u(t)})).flat():[]}(e)})).flat()),Array.from(new Set([].concat(Object(Pe.a)(r),Object(Pe.a)(i))))})).flat();J(e)}}),[T]),Object(a.useEffect)((function(){console.log("fields",U),g({items:{type:"object",title:"Logic",properties:{field:{enum:U,title:"Field",type:"string"},condition:{enum:["==","!=",">","<",">=","<=","ARRAY-CONTAINS","ARRAY-CONTAINS-NOT"],title:"Condition",type:"string"},value:{title:"Value",type:"string"},type:{title:"Type",enum:["boolean","number","integer","string"],type:"string"}},dependencies:{},required:[]},title:"Logic Array",type:"array",dependencies:{},required:[]})}),[U]);return R?Object(O.jsxs)(wt,{pb:3,children:[Object(O.jsx)(Et.a,{control:Object(O.jsx)(sn.a,{checked:k,onChange:function(e){_(e.target.checked)},name:"PingPong",color:"primary"}),label:"Ping Pong"}),Object(O.jsx)(pt,{schema:m,formData:y,onChange:function(e){return S(e)},onSubmit:function(){n(p,{conditions:y,pingpong:k}).then((function(e){return b("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")}))}})]}):Object(O.jsx)("p",{children:"No node connection or end_ui detected. Connect to one or check if form has fields."})},ln=n(310),dn=n(311),jn=function(){var e,t,n=E().createChain,a=Object(s.i)(),c=Object(s.h)(),r=Object(s.j)().campaignId,i=(0,Ke().parseId)(r),o=(null===c||void 0===c||null===(e=c.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(wt,{py:2,children:Object(O.jsx)(pt,{schema:ln,uiSchema:dn,onSubmit:function(e){console.log(e),r?n(Object(z.a)({campaign:i},e)).then((function(){a(o)})):alert("Error: No campaign id")}})})},pn=["task_stage"],bn=function(){var e=E(),t=e.getResponseFlattener,n=e.saveResponseFlattener,c=Mt().openToast,r=Object(s.j)().id,i=Ke().parseId,o=Object(a.useState)(),u=Object(j.a)(o,2),l=u[0],d=u[1],p=i(r);Object(a.useEffect)((function(){t(p).then((function(e){console.log(e);var t=e.task_stage,n=Object(U.a)(e,pn),a=Object(z.a)({task_stage:t.id},n);d(a)}))}),[p]);return Object(O.jsx)(T.a,{p:2,children:Object(O.jsx)(pt,{schema:{title:"Response Flattener",type:"object",required:["task_stage"],properties:{task_stage:{type:"integer",title:"Task stage"},copy_first_level:{type:"boolean",title:"Copy first level"},flatten_all:{type:"boolean",title:"Flatten all"},copy_system_fields:{type:"boolean",title:"Copy system fields"},exclude_list:{type:"array",title:"Exclude list",items:{type:"string"}},columns:{type:"array",title:"Columns",items:{type:"string"}}}},uiSchema:{exclude_list:{"ui:widget":"textarea"},columns:{"ui:widget":"textarea"}},formData:l,onChange:function(e){console.log(e),d(e)},onSubmit:function(){n(p,l).then((function(){return c("Saved","success")}))}})})},hn=n(312),fn=n.n(hn),On=function(e){var t=e.id,n=e.stage,a=e.onDownloadClick,c=e.onSettingsClick;return console.log(t,n),Object(O.jsx)(A.a,{sx:{width:"100%"},children:Object(O.jsx)(J.a,{action:Object(O.jsxs)(G.a,{direction:"row",spacing:1,children:[Object(O.jsx)(H.a,{onClick:function(){c(t)},children:Object(O.jsx)(fn.a,{})}),Object(O.jsx)(B.a,{variant:"contained",onClick:function(){a(n.id,t)},children:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c"},"open_button")]}),title:"Stage: ".concat(n.name),subheader:"ID: ".concat(t),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}})})},mn=function(){var e=E(),t=e.getResponseFlattenerList,n=e.downloadFlattenedResponses,c=Object(s.i)(),r=Mt().openToast,i=Object(s.j)().campaignId,o=(0,Ke().parseId)(i),u=Object(a.useState)([]),l=Object(j.a)(u,2),d=l[0],p=l[1];Object(a.useEffect)((function(){t(o).then((function(e){p(e)}))}),[o]);var b=function(e,t){n(e,t).catch((function(e){return r(e.message)}))},h=function(e){c("".concat(e))};return Object(O.jsxs)(T.a,{px:3,py:1,width:"100%",children:[Object(O.jsx)(B.a,{variant:"contained",onClick:function(){c("new")},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"}),Object(O.jsx)(D.a,{container:!0,py:2,spacing:2,children:d.map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:12,children:Object(O.jsx)(On,{id:e.id,stage:e.task_stage,onDownloadClick:b,onSettingsClick:h})},t)}))})]})},gn=function(){var e=E().createResponseFlattener,t=Mt().openToast,n=Object(s.i)(),c=Object(a.useState)({}),r=Object(j.a)(c,2),i=r[0],o=r[1];return Object(O.jsx)(T.a,{p:2,children:Object(O.jsx)(pt,{schema:{title:"Response Flattener",type:"object",required:["task_stage"],properties:{task_stage:{type:"integer",title:"Task stage"},copy_first_level:{type:"boolean",title:"Copy first level"},flatten_all:{type:"boolean",title:"Flatten all"},copy_system_fields:{type:"boolean",title:"Copy system fields"},exclude_list:{type:"string",title:"Exclude list"},columns:{type:"string",title:"Columns"}}},uiSchema:{exclude_list:{"ui:widget":"textarea"},columns:{"ui:widget":"textarea"}},formData:i,onChange:function(e){o(e)},onSubmit:function(){e(i).then((function(){return t("Saved","success")})).then((function(){return n(-1)}))}})})},xn=function(){return Object(O.jsx)(g,{children:Object(O.jsx)(Gt,{children:Object(O.jsx)(o.a,{children:Object(O.jsxs)(s.e,{children:[Object(O.jsxs)(s.c,{path:"/",element:Object(O.jsx)(S,{children:Object(O.jsx)(Be,{})}),children:[Object(O.jsxs)(s.c,{path:"campaign",children:[Object(O.jsxs)(s.c,{path:":campaignId",children:[Object(O.jsxs)(s.c,{path:"flattener",children:[Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(gn,{})}),Object(O.jsx)(s.c,{path:":id",element:Object(O.jsx)(bn,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(mn,{})})]}),Object(O.jsxs)(s.c,{path:"chain",children:[Object(O.jsxs)(s.c,{path:":chainId",children:[Object(O.jsx)(s.c,{path:"createstage/:stageId",element:Object(O.jsx)(on,{})}),Object(O.jsx)(s.c,{path:"createlogic/:stageId",element:Object(O.jsx)(un,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(tt,{})})]}),Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(jn,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Ae,{})})]})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{path:v.path,element:Object(O.jsx)(ie,{})})]})})})})},vn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,649)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),r(e),i(e)}))};i.a.render(Object(O.jsx)(c.a.StrictMode,{children:Object(O.jsx)(xn,{})}),document.getElementById("root")),vn()}},[[558,1,2]]]);
//# sourceMappingURL=main.09b25d2a.chunk.js.map