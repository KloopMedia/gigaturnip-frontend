(this["webpackJsonpgigaturnip-frontend"]=this["webpackJsonpgigaturnip-frontend"]||[]).push([[0],{298:function(e){e.exports=JSON.parse('{"type":"object","title":"Stage options","description":"Describe the stage you want.","properties":{"name":{"title":"Stage name","type":"string","description":"Example: Violation description form"},"description":{"title":"Stage description","type":"string","description":"Example: Form that describes an election violation","default":""},"is_creatable":{"type":"boolean","title":"Task is creatable","default":false},"copy_input":{"type":"boolean","title":"Copy input","default":false},"webhook_address":{"title":"Webhook address","type":"string","format":"uri"},"webhook_params":{"title":"Webhook parameters","type":"string"},"library":{"title":"Library","type":"string","default":""},"displayed_prev_stages":{"items":{"type":"number","enum":[]},"uniqueItems":true,"title":"Background Stages","type":"array"}},"dependencies":{},"required":["name"]}')},306:function(e){e.exports=JSON.parse('{"title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0446\u0435\u043f\u043e\u0447\u043a\u0438","type":"object","required":["name"],"properties":{"name":{"type":"string","title":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},"description":{"type":"string","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}}}')},307:function(e){e.exports=JSON.parse('{"description":{"ui:widget":"textarea"}}')},336:function(e,t,n){},362:function(e,t,n){},552:function(e,t,n){},553:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(33),i=n.n(c),o=(n(336),n(41)),s=n(28),u=n(3),l=n.n(u),d=n(6),j=n(11),p=n(285),b=n(85),h=(Object(p.a)({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"}),Object(b.b)()),f=new b.a;f.setCustomParameters({prompt:"select_account"});var O=n(2),m=r.a.createContext(null),g=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(j.a)(n,2),c=r[0],i=r[1],o=Object(a.useState)(!1),s=Object(j.a)(o,2),u=s[0],p=s[1];Object(a.useEffect)((function(){Object(b.d)(h,function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(t||null),p(!0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var g={user:c,ready:u,getToken:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.c)(c);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),login:function(e){return Object(b.e)(h,f).then((function(t){var n=t.user;console.log(n),i(n),e()}))},logout:function(e){return Object(b.f)(h).then((function(){i(null),e()}))}};return Object(O.jsx)(m.Provider,{value:g,children:t})},x=function(){return r.a.useContext(m)},v={title:"Login",path:"/login"},y=n(625),S=function(e){var t=e.children,n=x(),a=Object(s.g)();return console.log(n),n.ready&&!n.user?Object(O.jsx)(s.a,{to:v.path,state:{from:a}}):n.ready?t:Object(O.jsx)(y.a,{})},w="api/v1/chains/",C="api/v1/taskstages/",k="api/v1/conditionalstages/",_=n(288),I=n.n(_),N=n(8),E=n(616),T=n(618),D=r.a.createContext(null),F=r.a.forwardRef((function(e,t){return Object(O.jsx)(E.a,Object(N.a)({elevation:6,ref:t,variant:"filled"},e))})),B=function(e){var t=e.children,n=Object(a.useState)(!1),r=Object(j.a)(n,2),c=r[0],i=r[1],o=Object(a.useState)(""),s=Object(j.a)(o,2),u=s[0],l=s[1],d=Object(a.useState)("error"),p=Object(j.a)(d,2),b=p[0],h=p[1],f=function(e,t){"clickaway"!==t&&i(!1)},m={open:c,openToast:function(e,t){t&&h(t),l(function(e){switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return String(e)}}(e)),i(!0)},closeToast:f};return Object(O.jsxs)(D.Provider,{value:m,children:[Object(O.jsx)(T.a,{open:c,autoHideDuration:5e3,onClose:f,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(O.jsx)(F,{onClose:f,severity:b,sx:{width:"100%"},children:u})}),t]})},L=function(){return r.a.useContext(D)},P=function(){var e=L().openToast,t=x().getToken,n=I.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});n.interceptors.request.use((function(e){return t().then((function(t){return t&&e&&e.headers&&(e.headers.Authorization="JWT "+t),e}))}),(function(e){return Promise.reject(e)}));return{axios:n,getCampaigns:function(){return n.get("".concat("api/v1/campaigns/","?limit=1000")).then((function(e){return e.data})).then((function(e){return e.results})).catch((function(t){return e(t.message)}))},getChains:function(t){return n.get("".concat(w,"?campaign=").concat(t,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results})).catch((function(t){return e(t.message)}))},createChain:function(t){return n.post("".concat(w),t).catch((function(t){return e(t.message)}))},getStageNodes:function(t,a){return n.get("".concat(C,"?chain__campaign=").concat(t,"&chain=").concat(a,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results})).catch((function(t){return e(t.message)}))},getLogicNodes:function(t,a){return n.get("".concat(k,"?chain__campaign=").concat(t,"&chain=").concat(a,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results})).catch((function(t){return e(t.message)}))},getTaskStage:function(t){return n.get("".concat(C+t,"/")).then((function(e){return e.data})).catch((function(t){return e(t.message)}))},saveTaskStage:function(t,a){return n.patch("".concat(C+t,"/"),a).catch((function(t){return e(t.message)}))},getTaskStageOptions:function(){return n.options("".concat(C)).then((function(e){return e.data})).catch((function(t){return e(t.message)}))},getConditionalStage:function(t){return n.get("".concat(k+t,"/")).then((function(e){return e.data})).catch((function(t){return e(t.message)}))},saveConditionalStage:function(t,a){return n.patch("".concat(k+t,"/"),a).catch((function(t){return e(t.message)}))}}},A=n(634),z=n(630),J=n(623),R=n(629),G=n(631),q=n(622),U=n(628),M=function(e){var t=e.data,n=e.onClick,a=t.name,r=t.description,c=t.id;return Object(O.jsxs)(U.a,{children:[Object(O.jsxs)(R.a,{sx:{pb:1},children:[Object(O.jsx)(z.a,{variant:"h5",component:"div",children:a}),Object(O.jsxs)(z.a,{gutterBottom:!0,variant:"caption",color:"text.secondary",children:["ID: ",c]}),Object(O.jsx)(z.a,{overflow:"hidden",textOverflow:"ellipsis",variant:"body2",sx:{height:60,maxWidth:500},children:r})]}),Object(O.jsx)(G.a,{children:Object(O.jsx)(q.a,{size:"small",onClick:function(){n(c)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},W=n(24),V=n(632),H=n(609),X=n(289),Y=n.n(X),$=n(633),K=n(9),Q=n(627),Z=["expand"],ee=Object(K.a)((function(e){e.expand;var t=Object(W.a)(e,Z);return Object(O.jsx)(Q.a,Object(N.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),te=function(e){var t=e.data,n=e.children,r=e.hideExpandButton,c=e.hideOpenButton,i=e.onClick,o=t.name,s=(t.description,t.id),u=Object(a.useState)(!1),l=Object(j.a)(u,2),d=l[0],p=l[1],b=[];return c||b.push(Object(O.jsx)(q.a,{variant:"contained",onClick:function(){i&&i(s)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"},"open_button")),r||b.push(Object(O.jsx)(ee,{expand:d,onClick:function(){p(!d)},"aria-expanded":d,"aria-label":"show more",children:Object(O.jsx)(Y.a,{})},"expand_button")),Object(O.jsxs)(U.a,{children:[Object(O.jsx)(V.a,{action:Object(O.jsx)(H.a,{direction:"row",spacing:1,children:b}),title:o,subheader:"ID: ".concat(s),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(O.jsx)($.a,{in:d,timeout:"auto",unmountOnExit:!0,children:Object(O.jsx)(R.a,{children:n})})]})},ne=function(e){var t=e.data,n=e.view,a=e.onSelect;return t?"grid"===n?Object(O.jsx)(J.a,{container:!0,py:2,spacing:{xs:2,md:3},columns:{xs:4,sm:8,md:12},children:t.map((function(e,t){return Object(O.jsx)(J.a,{item:!0,xs:2,sm:4,md:4,children:Object(O.jsx)(M,{data:e,onClick:a})},t)}))}):"list"===n?Object(O.jsx)(J.a,{container:!0,py:2,spacing:2,children:t.map((function(e,t){return Object(O.jsx)(J.a,{item:!0,xs:12,children:Object(O.jsx)(te,{data:e,hideExpandButton:!0,onClick:a})},t)}))}):null:Object(O.jsx)(z.a,{children:"Error"})},ae=n(619),re=n(290),ce=n.n(re),ie=n(291),oe=n.n(ie),se=function(e){var t=e.label,n=e.view,a=e.location,r=e.hideLabel,c=e.hideCreateButton,i=e.hideViewButton,s=e.onViewChange;return Object(O.jsxs)(J.a,{container:!0,alignItems:"center",spacing:1,children:[Object(O.jsx)(J.a,{item:!0,flex:1,children:Object(O.jsx)(z.a,{hidden:r,variant:"h4",children:t})}),Object(O.jsx)(J.a,{item:!0,hidden:c,children:Object(O.jsx)(q.a,{component:o.b,to:"new",state:{from:a},variant:"contained",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})}),Object(O.jsxs)(J.a,{item:!0,hidden:i,children:[Object(O.jsx)(ae.a,{title:"\u0421\u0435\u0442\u043a\u0430",children:Object(O.jsx)(Q.a,{color:"grid"===n?"primary":"default",onClick:function(){return s("grid")},children:Object(O.jsx)(ce.a,{})})}),Object(O.jsx)(ae.a,{title:"\u0421\u043f\u0438\u0441\u043e\u043a",children:Object(O.jsx)(Q.a,{color:"list"===n?"primary":"default",onClick:function(){return s("list")},children:Object(O.jsx)(oe.a,{})})})]})]})},ue=function(e){var t=e.id,n=e.data,r=e.label,c=e.defaultView,i=e.hideLabel,o=e.hideCreateButton,u=e.hideViewButton,l=e.onSelect,d=Object(s.g)(),p=Object(a.useState)(null!==c&&void 0!==c?c:"grid"),b=Object(j.a)(p,2),h=b[0],f=b[1];Object(a.useEffect)((function(){if(!c){var e=localStorage.getItem("".concat(t,"_view"))||"grid";e&&f(e)}}),[]);return Object(O.jsxs)(A.a,{children:[Object(O.jsx)(se,{label:r,hideLabel:i,view:h,onViewChange:function(e){f(e),localStorage.setItem("".concat(t,"_view"),e)},location:d,hideCreateButton:o,hideViewButton:u}),Object(O.jsx)(ne,{data:n,view:h,onSelect:l})]})},le=function(){var e=P().getCampaigns,t=Object(s.h)(),n=Object(a.useState)([]),r=Object(j.a)(n,2),c=r[0],i=r[1];Object(a.useEffect)((function(){e().then((function(e){return i(e)}))}),[]);return Object(O.jsx)(A.a,{px:3,py:1,children:Object(O.jsx)(ue,{id:"campaigns",data:c,hideCreateButton:!0,label:"\u041a\u0430\u043c\u043f\u0430\u043d\u0438\u0438",onSelect:function(e){t("/campaign/".concat(e,"/chain"))}})})},de=function(){var e,t,n=x().login,a=Object(s.h)(),r=Object(s.g)(),c=(null===r||void 0===r||null===(e=r.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(q.a,{onClick:function(){n((function(){return a(c,{replace:!0})}))},children:"Login"})},je=n(5),pe=n(42),be=n(624),he=n(639),fe=n(635),Oe=n(638),me=n(641),ge=n(612),xe=n(640),ve=n(293),ye=n.n(ve),Se=n(295),we=n.n(Se),Ce=n(294),ke=n.n(Ce),_e=n(620),Ie=n(636),Ne=n(637),Ee=n(292),Te=n.n(Ee),De=240,Fe=function(e){return{width:De,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},Be=function(e){return Object(je.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.down("sm"),{width:0})},Le=Object(K.a)("div")((function(e){var t=e.theme;return Object(N.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),Pe=Object(K.a)(fe.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(N.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:De,width:"calc(100% - ".concat(De,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),Ae=Object(K.a)(be.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(N.a)(Object(N.a)({width:De,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(N.a)(Object(N.a)({},Fe(t)),{},{"& .MuiDrawer-paper":Fe(t)})),!n&&Object(N.a)(Object(N.a)({},Be(t)),{},{"& .MuiDrawer-paper":Be(t)}))}));function ze(e){var t=Object(pe.a)(),n=Object(s.i)().campaignId,a=Object(s.h)(),c=x().logout,i=r.a.useState(!1),u=Object(j.a)(i,2),l=u[0],d=u[1],p=e.children,b=[{page:"chain",title:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",icon:Object(O.jsx)(Te.a,{})}];return Object(O.jsxs)(A.a,{sx:{display:"flex"},children:[Object(O.jsx)(ge.a,{}),Object(O.jsx)(Pe,{position:"fixed",open:l,children:Object(O.jsxs)(Oe.a,{children:[n&&Object(O.jsx)(Q.a,{color:"inherit","aria-label":"open drawer",onClick:function(){d(!0)},edge:"start",sx:Object(N.a)({marginRight:"36px"},l&&{display:"none"}),children:Object(O.jsx)(ye.a,{})}),Object(O.jsx)(A.a,{sx:{flexGrow:1},children:Object(O.jsx)(he.a,{component:o.b,color:"inherit",underline:"none",variant:"h6",noWrap:!0,to:"/",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"GigaTurnip Admin Interface"})}),Object(O.jsx)(q.a,{color:"inherit",onClick:function(){return c((function(){return a("/")}))},children:"\u0412\u044b\u0445\u043e\u0434"})]})}),n&&Object(O.jsxs)(Ae,{variant:"permanent",open:l,children:[Object(O.jsx)(Le,{children:Object(O.jsx)(Q.a,{onClick:function(){d(!1)},children:"rtl"===t.direction?Object(O.jsx)(ke.a,{}):Object(O.jsx)(we.a,{})})}),Object(O.jsx)(xe.a,{}),Object(O.jsx)(me.a,{children:b.map((function(e){return Object(O.jsxs)(_e.a,{component:o.b,to:"campaign/".concat(n,"/").concat(e.page),children:[Object(O.jsx)(Ie.a,{children:e.icon}),Object(O.jsx)(Ne.a,{primary:e.title})]})}))})]}),Object(O.jsxs)(A.a,{component:"main",sx:{flexGrow:1,width:"100%"},children:[Object(O.jsx)(Le,{}),p]})]})}var Je=function(){return Object(O.jsx)("div",{children:Object(O.jsx)(ze,{children:Object(O.jsx)(s.b,{})})})},Re=function(){var e=P().getChains,t=Object(s.h)(),n=Object(s.i)().campaignId,r=Object(a.useState)([]),c=Object(j.a)(r,2),i=c[0],o=c[1];Object(a.useEffect)((function(){if(n){var t=parseInt(n);e(t).then((function(e){return o(e)}))}}),[]);return Object(O.jsx)(A.a,{px:3,py:1,children:Object(O.jsx)(ue,{id:"chains",data:i,label:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",onSelect:function(e){t("".concat(e))}})})},Ge=n(25),qe=n(62),Ue=Object(K.a)(A.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius}})),Me=function(e){var t=e.data,n=e.type;return Object(O.jsxs)(Ue,{type:n,children:[Object(O.jsx)(z.a,{children:t.label}),Object(O.jsx)(qe.b,{type:"target",position:qe.c.Top,style:{borderRadius:"100%",width:10,height:10}}),Object(O.jsx)(qe.b,{type:"source",position:qe.c.Bottom,style:{borderRadius:"100%",width:10,height:10}})]})},We=Object(K.a)(Me)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main}})),Ve=function(e){var t=e.data;return Object(O.jsx)(We,{data:t,type:"logic"})},He=Object(K.a)(Me)((function(e){var t=e.theme;return{color:t.palette.success.contrastText,backgroundColor:t.palette.success.main}})),Xe=function(e){var t=e.data;return Object(O.jsx)(He,{data:t,type:"stage"})},Ye=(n(362),n(203)),$e=n(119),Ke=n.n($e),Qe=n(157),Ze=n.n(Qe),et=function(){var e=P().axios,t=function(e,t){return t.filter((function(t){return t.id===e})).pop()},n=function(e){return"STAGE"===e.type?C:"LOGIC"===e.type?k:void 0},a=function(){var t=Object(d.a)(l.a.mark((function t(a){var r,c,i,o,s,u,d,j,p;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.node,c=a.currentNodeId,i=a.type,o=a.method,!(s=n(r))){t.next=7;break}return t.next=5,e.get(s+r.id+"/").then((function(e){return"in"===i?e.data.in_stages:"out"===i?e.data.out_stages:void 0})).catch((function(e){}));case 5:(u=t.sent)&&(d=u.map((function(e){return e.toString()})),j=[],"create"===o&&(j=[c].concat(Object(Ge.a)(d))),"delete"===o&&(j=d.filter((function(e){return e!==c}))),p=void 0,"in"===i&&(p={in_stages:j}),"out"===i&&(p={out_stages:j}),p&&(console.log(p),e.patch(s+r.id+"/",p)));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=function(e,n,r){var c=t(e,r),i=t(n,r);c&&a({node:c,currentNodeId:n,type:"in",method:"delete"}),i&&a({node:i,currentNodeId:e,type:"out",method:"delete"})},c=function(){var t=Object(d.a)(l.a.mark((function t(a,r){var c,i,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c={name:a.label,x_pos:Math.round(a.position.x),y_pos:Math.round(a.position.y),chain:r,out_stages:[]},!(i=n(a))){t.next=7;break}return t.next=5,e.post(i,c).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 5:return o=t.sent,t.abrupt("return",o.id.toString());case 7:return t.abrupt("return",void 0);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{getFormFields:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(Ye.B)(e),a=Object(Ye.G)(n,"",e,t),r=function(e,t){return function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""];return Object.keys(n).forEach((function(c){if("object"===typeof n[c]){var i=r.map((function(e){return"".concat(e,".").concat(c)}));n[c].__rjsf_additionalProperties&&""!==n[c].$name?a.push(n[c].$name):e(n[c],a,i)}else"$name"===c&&""!==n[c]&&r.forEach((function(e){e=e.replace(/^\./,"");var n=Ke()(t,e);("object"!==typeof n||Ze()(n))&&a.push(e)}))})),a}(e)};return r(a,t)},parseId:function(e){if(e)return parseInt(e);throw new Error("No id")},getNode:t,getUrl:n,updateConnections:a,addConnections:function(e,n,r){var c=t(e,r),i=t(n,r);c&&a({node:c,currentNodeId:n,type:"in",method:"create"}),i&&a({node:i,currentNodeId:e,type:"out",method:"create"})},removeConnections:r,removeElements:function(t,a){var c=t.map((function(e){return e.id}));return a.filter((function(t){if(c.includes(t.id)){if(Object(qe.f)(t)){var i=parseInt(t.target),o=parseInt(t.source);r(i,o,a)}else{var s=n(t);s&&e.delete(s+t.id+"/")}return!1}return!0}))},updateNode:function(t){var a={x_pos:Math.round(t.position.x),y_pos:Math.round(t.position.y)},r=n(t);console.log(a),r&&e.patch(r+t.id+"/",a).then((function(e){return console.log(e.data)}))},createNode:c}},tt=n(614),nt=Object(K.a)(A.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius,cursor:"grab",margin:8}})),at=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),i=Object(j.a)(c,2),o=i[0],s=i[1];Object(a.useEffect)((function(){r(!(!o||""===o))}),[o]);var u=function(e,t,n){var a=JSON.stringify({label:o,type:n});e.dataTransfer.setData("application/reactflow",a),e.dataTransfer.effectAllowed="move"},l=function(){s("")};return Object(O.jsxs)(J.a,{item:!0,container:!0,justifyContent:"center",px:1,children:[Object(O.jsxs)(J.a,{container:!0,item:!0,mt:2,justifyContent:"center",children:[Object(O.jsx)(tt.a,{label:"Label",size:"small",value:o,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)(z.a,{py:1,variant:"caption",color:"red",align:"center",children:!n&&"Enter label to drag the node"})]}),Object(O.jsxs)(J.a,{item:!0,children:[Object(O.jsx)(nt,{type:"stage",onDragEnd:l,onDragStart:function(e){return u(e,0,"STAGE")},draggable:n,children:"Taskstage Node"}),Object(O.jsx)(nt,{type:"logic",onDragEnd:l,onDragStart:function(e){return u(e,0,"LOGIC")},draggable:n,children:"Conditional Node"})]})]})},rt=function(){var e=Object(a.useRef)(null),t=P(),n=t.getStageNodes,r=t.getLogicNodes,c=et(),i=c.parseId,o=c.addConnections,u=c.createNode,p=c.removeElements,b=c.updateNode,h=Object(s.i)(),f=h.campaignId,m=h.chainId,g=Object(a.useState)(null),x=Object(j.a)(g,2),v=x[0],y=x[1],S=Object(a.useState)([]),w=Object(j.a)(S,2),C=w[0],k=w[1],_=Object(s.h)(),I=i(f),E=i(m),T={style:{strokeWidth:3},arrowHeadType:"arrow"};Object(a.useEffect)((function(){Promise.all([n(I,E),r(I,E)]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){return e.type="STAGE"})),n.forEach((function(e){return e.type="LOGIC"}));var a=[].concat(Object(Ge.a)(t),Object(Ge.a)(n)),r=a.map((function(e){return{id:e.id.toString(),position:{x:parseFloat(e.x_pos),y:parseFloat(e.y_pos)},data:{label:e.name},type:e.type}}));return k(r),a})).then((function(e){e.forEach((function(e){e.in_stages.length>0&&e.in_stages.forEach((function(t){var n=Object(N.a)({source:t.toString(),target:e.id.toString(),id:"".concat(t,"-").concat(e.id)},T);k((function(e){return Object(qe.d)(n,e)}))}))}))}))}),[E]);var D=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(N.a)(Object(N.a)({},t),T),a=n.target,r=n.source,k((function(e){return Object(qe.d)(n,e)})),o(a,r,C);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var t=Object(d.a)(l.a.mark((function t(n){var a,r,c,i,o,s,d,j;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),a=e.current.getBoundingClientRect(),r=n.dataTransfer.getData("application/reactflow"),c=v.project({x:n.clientX-a.left,y:n.clientY-a.top}),i=JSON.parse(r),o=i.label,s=i.type,""!==o){t.next=9;break}return t.abrupt("return",0);case 9:return t.next=11,u({type:s,position:c,label:o},E);case 11:d=t.sent,j={id:d,type:s,position:c,data:{label:o}},k((function(e){return[].concat(Object(Ge.a)(e),[j])}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),B=function(e,t){console.log(t),t.id&&("LOGIC"===t.type&&_("createlogic/".concat(t.id)),"STAGE"===t.type&&_("createstage/".concat(t.id)))},L={LOGIC:Ve,STAGE:Xe};return Object(O.jsxs)(J.a,{container:!0,children:[Object(O.jsx)(J.a,{item:!0,md:10,zIndex:1,children:Object(O.jsx)(qe.e,{ref:e,nodeTypes:L,elements:C,onConnect:D,onElementsRemove:function(e){k((function(t){return p(e,t)}))},onNodeDoubleClick:B,onEdgeDoubleClick:B,onLoad:function(e){return y(e)},onDrop:F,onDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"},onNodeDragStop:function(e,t){b(t)},preventScrolling:!0,style:{width:"94vw",height:"90vh"},children:Object(O.jsx)(qe.a,{})})}),Object(O.jsx)(J.a,{item:!0,md:2,zIndex:2,height:200,sx:{background:"white"},children:Object(O.jsx)(at,{})})]})},ct=n(296),it=n.n(ct),ot=Object(K.a)(Q.a)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.dark}}})),st=function(e){var t=e.mode,n=e.allModes,a=e.onChange,r=e.onBack;return Object(O.jsxs)(A.a,{display:"flex",justifyContent:"flex-end",sx:{position:"sticky",top:60},p:1,zIndex:1,children:[Object(O.jsx)(A.a,{flex:1,children:Object(O.jsx)(ae.a,{title:"\u041d\u0430\u0437\u0430\u0434",children:Object(O.jsx)(ot,{onClick:r,children:Object(O.jsx)(it.a,{fontSize:"large"})})})}),Object(O.jsx)(H.a,{direction:"row",spacing:1,children:Object.keys(n).map((function(e){var r=t===e?"primary":"default",c=n[e].title,i=n[e].icon;return Object(O.jsx)(A.a,{children:Object(O.jsx)(ae.a,{title:c,children:Object(O.jsx)(Q.a,{color:r,onClick:function(){return a(e)},children:i})})},e)}))})]})},ut=function(e){e.id,e.schema,e.options,e.value,e.required,e.disabled,e.readonly,e.label,e.onChange,e.onBlur,e.onFocus;return Object(O.jsx)("p",{children:"\u0417\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 \u0430\u0443\u0434\u0438\u043e"})},lt=n(27),dt=function(e){var t=e.id,n=e.placeholder,a=e.required,r=e.readonly,c=e.disabled,i=e.label,o=e.value,s=e.onChange,u=e.onBlur,l=e.onFocus,d=e.autofocus,j=e.options,p=e.schema,b=e.rawErrors,h=void 0===b?[]:b,f="string"===p.type?"text":"".concat(p.type);return Object(O.jsxs)(lt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(lt.a.Label,{className:h.length>0?"text-danger":"",children:[i||p.title,(i||p.title)&&a?"*":null]}),Object(O.jsx)(lt.a.Control,{id:t,placeholder:n,autoFocus:d,required:a,disabled:c,readOnly:r,className:h.length>0?"is-invalid":"",list:p.examples?"examples_".concat(t):void 0,type:f,value:o||0===o?o:"",onChange:function(e){var t=e.target.value;return s(""===t?j.emptyValue:t)},onBlur:function(e){var n=e.target.value;return u(t,n)},onFocus:function(e){var n=e.target.value;return l(t,n)}}),p.examples?Object(O.jsx)("datalist",{id:"examples_".concat(t),children:p.examples.concat(p.default?[p.default]:[]).map((function(e){return Object(O.jsx)("option",{value:e},e)}))}):null]})},jt=function(e){var t=e.required,n=e.label,a=e.value,r=e.schema,c=e.rawErrors,i=void 0===c?[]:c;return a?Object(O.jsxs)(lt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(lt.a.Label,{className:i.length>0?"text-danger":"",children:[n||r.title,(n||r.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsx)("a",{href:a,children:a})]}):null},pt=function(e){var t=e.id,n=e.schema,a=e.options,r=e.value,c=e.required,i=e.disabled,o=e.readonly,s=e.label,u=e.onChange,l=e.onBlur,d=e.onFocus,j=a.enumOptions,p=a.enumDisabled,b=function(e){var t=e.target.value;return u("boolean"==n.type?"false"!==t:t)},h=function(e){var n=e.target.value;return l(t,n)},f=function(e){var n=e.target.value;return d(t,n)},m=Boolean(a&&a.inline);return Object(O.jsxs)(lt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(lt.a.Label,{className:"d-block",children:[s||n.title,(s||n.title)&&c?"*":null]}),j.map((function(e,n){var a=Array.isArray(p)&&-1!==p.indexOf(e.value),s=e.value==r;return Object(O.jsx)(lt.a.Check,{inline:m,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:i||a||o,checked:s,required:c,value:e.value,onChange:b,onBlur:h,onFocus:f},n)}))]})},bt=n(308),ht=(n(282),function(e){var t=e.schema,n=e.uiSchema,a=e.formData,r=e.hideButton,c=e.onChange,i=e.onSubmit,o={customfile:ut,autocomplete:dt,RadioWidget:pt,customlink:jt,audio:ut};return Object(O.jsx)(bt.a,{schema:t,uiSchema:n,formData:a,widgets:o,onChange:function(e){if(console.log(e.formData),!c)return 0;c(e.formData)},onSubmit:function(e){if(console.log(e.formData),!i)return 0;i(e.formData)},children:r?" ":Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})}),ft=n(298),Ot=n(21),mt={audio:{displayName:"Audio",matchIf:[{types:["string"],widget:"audio"}],possibleOptions:["private","default"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"audio","ui:options":{private:!1,default:""}},type:"string",cardBody:function(e){var t,n,a,r=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=r["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return c(Object(N.a)(Object(N.a)({},r),{},{"ui:options":Object(N.a)(Object(N.a)({},r["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsx)("h5",{children:"Default Audio (Link)"}),Object(O.jsx)(Ot.f,{value:null!==(n=null===(a=r["ui:options"])||void 0===a?void 0:a.default)&&void 0!==n?n:"",placeholder:"Default",type:"text",onChange:function(e){return c(Object(N.a)(Object(N.a)({},r),{},{"ui:options":Object(N.a)(Object(N.a)({},r["ui:options"]),{},{default:e.target.value})}))},className:"card-text"})]})}}},gt={autocomplete:{displayName:"AutoComplete",matchIf:[{types:["string"],widget:"autocomplete"}],possibleOptions:["webhook","params","searchField","responseField"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"autocomplete","ui:options":{webhook:"",params:"",searchField:"",responseField:""}},type:"string",cardBody:function(e){var t,n,a,c,i=e.parameters,o=e.onChange;return Object(O.jsxs)(r.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Webhook"}),Object(O.jsx)(Ot.f,{value:null===(t=i["ui:options"])||void 0===t?void 0:t.webhook,placeholder:"Webhook",type:"text",onChange:function(e){return o(Object(N.a)(Object(N.a)({},i),{},{"ui:options":Object(N.a)(Object(N.a)({},i["ui:options"]),{},{webhook:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)("h5",{children:"Params"}),Object(O.jsx)(Ot.f,{value:null===(n=i["ui:options"])||void 0===n?void 0:n.params,placeholder:"Params",type:"text",onChange:function(e){return o(Object(N.a)(Object(N.a)({},i),{},{"ui:options":Object(N.a)(Object(N.a)({},i["ui:options"]),{},{params:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{width:"100%",paddingRight:7},children:[Object(O.jsx)("h5",{children:"Search Field"}),Object(O.jsx)(Ot.f,{value:null===(a=i["ui:options"])||void 0===a?void 0:a.searchField,placeholder:"Search Field",type:"text",onChange:function(e){return o(Object(N.a)(Object(N.a)({},i),{},{"ui:options":Object(N.a)(Object(N.a)({},i["ui:options"]),{},{searchField:e.target.value})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{width:"100%",paddingLeft:7},children:[Object(O.jsx)("h5",{children:"Response Field"}),Object(O.jsx)(Ot.f,{value:null===(c=i["ui:options"])||void 0===c?void 0:c.responseField,placeholder:"Response Field",type:"text",onChange:function(e){return o(Object(N.a)(Object(N.a)({},i),{},{"ui:options":Object(N.a)(Object(N.a)({},i["ui:options"]),{},{responseField:e.target.value})}))},className:"card-text"})]})]})]})}}},xt={file:{displayName:"File",matchIf:[{types:["string"],widget:"customfile"}],possibleOptions:["private","multiple"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customfile","ui:options":{private:!1,multiple:!1}},type:"string",cardBody:function(e){var t,n,a=e.parameters,r=e.onChange;return Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=a["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return r(Object(N.a)(Object(N.a)({},a),{},{"ui:options":Object(N.a)(Object(N.a)({},a["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Multiple Files"}),Object(O.jsx)("input",{checked:null===(n=a["ui:options"])||void 0===n?void 0:n.multiple,type:"checkbox",onChange:function(e){return r(Object(N.a)(Object(N.a)({},a),{},{"ui:options":Object(N.a)(Object(N.a)({},a["ui:options"]),{},{multiple:e.target.checked})}))},className:"card-text"})]})]})}}},vt={link:{displayName:"Link",matchIf:[{types:["string"],widget:"customlink"}],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customlink"},type:"string",cardBody:function(e){var t,n=e.parameters,a=e.onChange;return Object(O.jsxs)(r.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(Ot.f,{value:null!==(t=n.default)&&void 0!==t?t:"",placeholder:"Default",type:"text",onChange:function(e){return a(Object(N.a)(Object(N.a)({},n),{},{default:e.target.value}))},className:"card-text"})]})}}},yt=n(309),St=function(e){var t=e.schema,n=e.uiSchema,a=e.onChange,r=Object(N.a)(Object(N.a)(Object(N.a)(Object(N.a)({},xt),gt),vt),mt);return Object(O.jsx)(yt.a,{schema:t,uischema:n,onChange:function(e,t){a(e,t)},mods:{customFormInputs:r}})},wt=Object(K.a)(A.a)((function(){return{width:"70%",minWidth:"400px",margin:"0 auto"}})),Ct=function(e){var t=e.schema,n=e.uiSchema,a=e.formData,r=e.onSchemaChange,c=e.onFormDataChange,i=Object(N.a)({},ft),o=a.in_stages;return o?(i.properties.displayed_prev_stages.items.enum=o,i.properties.displayed_prev_stages.description=""):i.properties.displayed_prev_stages.description="\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u043e\u0432.",Object(O.jsxs)(A.a,{p:1,children:[Object(O.jsx)(St,{schema:t,uiSchema:n,onChange:r}),Object(O.jsx)(wt,{children:Object(O.jsx)(ht,{schema:i,uiSchema:{displayed_prev_stages:{"ui:widget":"checkboxes"}},formData:a,onChange:c,hideButton:!0})})]})},kt=n(160),_t=function(e){var t=e.data;return Object(O.jsx)(kt.a,{id:"ViewerTinyMCE",value:t,toolbar:!1,inline:!1,disabled:!0,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autoresize",menubar:!1,image_advtab:!0,importcss_append:!0}})},It=function(e){var t=e.schema,n=e.uiSchema,a=e.text;return Object(O.jsxs)(wt,{children:[a&&Object(O.jsx)(_t,{data:a}),Object(O.jsx)(A.a,{py:1,children:Object(O.jsx)(ht,{schema:t,uiSchema:n})})]})},Nt=n(642),Et=n(643),Tt=n(644),Dt=function(e){var t=e.isEditable,n=e.schema,a=e.ui,r=e.onSchemaChange,c=e.onUiChange,i=e.onIsEditableChange,o=e.onSave,s=e.onUndo,u=n,l=a;try{var d=JSON.parse(n);u=JSON.stringify(d,null,2);var j=JSON.parse(a);l=JSON.stringify(j,null,2)}catch(p){console.log(p)}return Object(O.jsxs)(A.a,{children:[Object(O.jsxs)(J.a,{container:!0,alignItems:"center",children:[Object(O.jsx)(Nt.a,{sx:{my:1},children:Object(O.jsx)(Et.a,{control:Object(O.jsx)(Tt.a,{checked:t,onChange:function(){i()},name:"edit",inputProps:{"aria-label":"edit"}}),labelPlacement:"start",label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})}),t&&Object(O.jsx)(q.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){o()},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"}),t&&Object(O.jsx)(q.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){s()},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"})]}),Object(O.jsxs)(J.a,{container:!0,children:[Object(O.jsx)(J.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(tt.a,{label:"Schema",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:u,onChange:function(e){r(e.target.value)},style:{marginTop:15,marginBottom:15}})}),Object(O.jsx)(J.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(tt.a,{label:"Ui",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:l,onChange:function(e){c(e.target.value)},style:{marginTop:15,marginBottom:30}})})]})]})},Ft=n(301),Bt=function(e){var t=e.id,n=P().getTaskStageOptions,r=Object(a.useState)({}),c=Object(j.a)(r,2),i=c[0],o=c[1],s=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t.actions.POST);case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(e){var t=["string","number","integer","boolean","null"],n=e?Object.keys(e):[],a={},r=[];n.forEach((function(n){var c=e[n],i=c.type,o=c.label,s=c.help_text,u=c.required;t.includes(i)?(a[n]={type:i,title:o,description:s},u&&r.push(n)):"decimal"===i&&(a[n]={type:"number",title:o,description:s},u&&r.push(n))}));var c={type:"object",properties:a,required:r};return console.log(c),c};return Object(a.useEffect)((function(){t&&function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:t=e.sent,n=u(t),o(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(O.jsx)("div",{children:Object(O.jsx)(ht,{schema:i})})},Lt=function(e){Object(Ft.a)(e);return Object(O.jsx)(wt,{children:Object(O.jsx)(J.a,{container:!0,py:2,spacing:2,children:[1,2].map((function(e,t){return Object(O.jsx)(J.a,{item:!0,xs:12,children:Object(O.jsx)(te,{data:{name:e},hideOpenButton:!0,children:Object(O.jsx)(Bt,{id:e})})},t)}))})})},Pt=(n(552),function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(kt.a,{id:"EditorTinyMCE",onEditorChange:function(e,t){n(e)},value:t,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autosave save print preview paste importcss searchreplace autolink directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap emoticons autoresize",menubar:"file edit view insert format tools table help",toolbar:"undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media link anchor codesample | ltr rtl",toolbar_sticky:!0,image_advtab:!0,importcss_append:!0,image_caption:!0,noneditable_noneditable_class:"mceNonEditable",toolbar_mode:"sliding",contextmenu:"link image imagetools table",autosave_prefix:"tinymce-autosave-{path}{query}-",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})}),At=function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(wt,{children:Object(O.jsx)(Pt,{data:t,onChange:n})})},zt=n(302),Jt=n.n(zt),Rt=n(303),Gt=n.n(Rt),qt=n(304),Ut=n.n(qt),Mt=n(305),Wt=n.n(Mt),Vt=["id","json_schema","ui_schema","rich_text","webhook_address","webhook_params"],Ht=["chain","webhook_params"],Xt=function(){var e=Object(s.i)().stageId,t=Object(s.h)(),n=P(),r=n.getTaskStage,c=n.saveTaskStage,i=(0,et().parseId)(e),o=L().openToast,u=Object(a.useState)(""),p=Object(j.a)(u,2),b=p[0],h=p[1],f=Object(a.useState)(""),m=Object(j.a)(f,2),g=m[0],x=m[1],v=Object(a.useState)({}),y=Object(j.a)(v,2),S=y[0],w=y[1],C=Object(a.useState)("builder"),k=Object(j.a)(C,2),_=k[0],I=k[1],E=Object(a.useState)(""),T=Object(j.a)(E,2),D=T[0],F=T[1],B=Object(a.useState)(!1),z=Object(j.a)(B,2),J=z[0],R=z[1],G=Object(a.useState)(""),U=Object(j.a)(G,2),M=U[0],V=U[1],H=Object(a.useState)(""),X=Object(j.a)(H,2),Y=X[0],$=X[1],K=Object(a.useState)(""),Q=Object(j.a)(K,2),Z=Q[0],ee=Q[1],te=Object(a.useState)(""),ne=Object(j.a)(te,2),ae=ne[0],re=ne[1],ce={builder:{title:"\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440",icon:Object(O.jsx)(Jt.a,{fontSize:"large"})},text:{title:"\u0422\u0435\u043a\u0441\u0442",icon:Object(O.jsx)(Gt.a,{fontSize:"large"})},preview:{title:"\u041f\u0440\u0435\u0432\u044c\u044e",icon:Object(O.jsx)(Ut.a,{fontSize:"large"})},editor:{title:"\u0421\u0445\u0435\u043c\u044b",icon:Object(O.jsx)(Wt.a,{fontSize:"large"})}};Object(a.useEffect)((function(){i&&function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,c,i,o,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t);case 2:n=e.sent,n.id,a=n.json_schema,c=n.ui_schema,i=n.rich_text,o=n.webhook_address,s=n.webhook_params,(u=Object(W.a)(n,Vt)).webhook_address=o||void 0,u.webhook_params=s?JSON.stringify(s):void 0,h(a),x(c),V(a),$(c),ee(a),re(c),w(u),F(i);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(i)}),[i]);var ie=function(e,t){h(e),x(t),ee(e),re(t),V(e),$(t)},oe=function(e){w(e)},se=function(e){F(e)},ue=function(){R(!J)},le=function(e){V(e)},de=function(e){$(e)},je=function(){h(M),x(Y)},pe=function(){h(Z),x(ae),V(Z),$(ae)},be=b?JSON.parse(b):{},he=g?JSON.parse(g):{};return Object(O.jsxs)(A.a,{children:[Object(O.jsx)(st,{allModes:ce,mode:_,onChange:function(e){I(e)},onBack:function(){t(-1)}}),function(e){switch(e){case"builder":return Object(O.jsx)(Ct,{schema:b,uiSchema:g,formData:S,onSchemaChange:ie,onFormDataChange:oe});case"plugins":return Object(O.jsx)(Lt,{});case"text":return Object(O.jsx)(At,{data:D,onChange:se});case"preview":return Object(O.jsx)(It,{schema:be,uiSchema:he,text:D});case"editor":return Object(O.jsx)(Dt,{isEditable:J,schema:M,ui:Y,onSchemaChange:le,onUiChange:de,onIsEditableChange:ue,onSave:je,onUndo:pe})}}(_),Object(O.jsx)(wt,{pb:3,children:Object(O.jsx)(q.a,{variant:"contained",color:"warning",fullWidth:!0,onClick:function(){(function(){S.chain;var e=S.webhook_params,t=Object(W.a)(S,Ht),n=e?JSON.parse(e):null,a=Object(N.a)(Object(N.a)({},t),{},{json_schema:b,ui_schema:g,rich_text:D,webhook_params:n});return c(i,a)})().then((function(e){return o("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")}))},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})},Yt=n(621),$t=function(){var e=P(),t=e.getConditionalStage,n=e.saveConditionalStage,r=e.getTaskStage,c=Object(s.i)().stageId,i=et(),o=i.parseId,u=i.getFormFields,p=o(c),b=L().openToast,h=Object(a.useState)({}),f=Object(j.a)(h,2),m=f[0],g=f[1],x=Object(a.useState)({}),v=Object(j.a)(x,2),y=v[0],S=v[1],w=Object(a.useState)(!1),C=Object(j.a)(w,2),k=C[0],_=C[1],I=Object(a.useState)(),E=Object(j.a)(I,2),T=E[0],D=E[1],F=Object(a.useState)(!1),B=Object(j.a)(F,2),A=B[0],z=B[1],J=Object(a.useState)([]),R=Object(j.a)(J,2),G=R[0],q=R[1];Object(a.useEffect)((function(){t(p).then((function(e){S(e.conditions),_(e.pingpong)}))}),[p]),Object(a.useEffect)((function(){var e=function(e){if(e){var n=r(e);return n||t(e)}return t(p)};p&&function(){var t=Object(d.a)(l.a.mark((function t(){var n,a,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent,!(a=k?n.out_stages:n.in_stages)){t.next=9;break}return t.next=7,Promise.all(a.map(function(){var t=Object(d.a)(l.a.mark((function t(n){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return a=t.sent,t.abrupt("return",Object(je.a)({},n,a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 7:r=t.sent,Object.keys(r).length>0&&(D(r),z(!0));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[p,k]),Object(a.useEffect)((function(){if(T&&T.length>0){var e=T.map((function(e){var t=Object.values(e)[0],n=t.json_schema?JSON.parse(t.json_schema):{},a={};n&&n.dependencies&&Object.keys(n.dependencies).length>0&&(a=n.dependencies);var r=Object.values(a),c=u(n),i=[];return r.length>0&&(i=r.map((function(e){return function(e){var t=null;return e.hasOwnProperty("oneOf")&&(t=e.oneOf),e.hasOwnProperty("allOf")&&(t=e.allOf),t?t.map((function(e){var t=Object(N.a)({type:"object"},e);return u(t)})).flat():[]}(e)})).flat()),Array.from(new Set([].concat(Object(Ge.a)(c),Object(Ge.a)(i))))})).flat();q(e)}}),[T]),Object(a.useEffect)((function(){console.log("fields",G),g({items:{type:"object",title:"Logic",properties:{field:{enum:G,title:"Field",type:"string"},condition:{enum:["==","!=",">","<",">=","<=","ARRAY-CONTAINS","ARRAY-CONTAINS-NOT"],title:"Condition",type:"string"},value:{title:"Value",type:"string"}},dependencies:{},required:[]},title:"Logic Array",type:"array",dependencies:{},required:[]})}),[G]);return A?Object(O.jsxs)(wt,{pb:3,children:[Object(O.jsx)(Et.a,{control:Object(O.jsx)(Yt.a,{checked:k,onChange:function(e){_(e.target.checked)},name:"PingPong",color:"primary"}),label:"Ping Pong"}),Object(O.jsx)(ht,{schema:m,formData:y,onChange:function(e){return S(e)},onSubmit:function(){n(p,{conditions:y,pingpong:k}).then((function(e){return b("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")}))}})]}):Object(O.jsx)("p",{children:"No node connection or end_ui detected. Connect to one or check if form has fields."})},Kt=n(306),Qt=n(307),Zt=function(){var e,t,n=P().createChain,a=Object(s.h)(),r=Object(s.g)(),c=Object(s.i)().campaignId,i=(0,et().parseId)(c),o=(null===r||void 0===r||null===(e=r.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(wt,{py:2,children:Object(O.jsx)(ht,{schema:Kt,uiSchema:Qt,onSubmit:function(e){console.log(e),c?n(Object(N.a)({campaign:i},e)).then((function(){a(o)})):alert("Error: No campaign id")}})})},en=function(){return Object(O.jsx)(g,{children:Object(O.jsx)(B,{children:Object(O.jsx)(o.a,{children:Object(O.jsxs)(s.e,{children:[Object(O.jsxs)(s.c,{path:"/",element:Object(O.jsx)(S,{children:Object(O.jsx)(Je,{})}),children:[Object(O.jsxs)(s.c,{path:"campaign",children:[Object(O.jsx)(s.c,{path:":campaignId",children:Object(O.jsxs)(s.c,{path:"chain",children:[Object(O.jsxs)(s.c,{path:":chainId",children:[Object(O.jsx)(s.c,{path:"createstage/:stageId",element:Object(O.jsx)(Xt,{})}),Object(O.jsx)(s.c,{path:"createlogic/:stageId",element:Object(O.jsx)($t,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(rt,{})})]}),Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(Zt,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Re,{})})]})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(le,{})})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(le,{})})]}),Object(O.jsx)(s.c,{path:v.path,element:Object(O.jsx)(de,{})})]})})})})},tn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,645)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(en,{})}),document.getElementById("root")),tn()}},[[553,1,2]]]);
//# sourceMappingURL=main.b0021b6e.chunk.js.map