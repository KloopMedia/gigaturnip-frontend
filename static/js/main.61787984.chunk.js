(this["webpackJsonpgigaturnip-frontend"]=this["webpackJsonpgigaturnip-frontend"]||[]).push([[0],{298:function(e){e.exports=JSON.parse('{"type":"object","title":"Stage options","description":"Describe the stage you want.","properties":{"name":{"title":"Stage name","type":"string","description":"Example: Violation description form"},"description":{"title":"Stage description","type":"string","description":"Example: Form that describes an election violation","default":""},"is_creatable":{"type":"boolean","title":"Task is creatable","default":false},"copy_input":{"type":"boolean","title":"Copy input","default":false},"webhook_address":{"title":"Webhook address","type":"string","format":"uri"},"webhook_params":{"title":"Webhook parameters","type":"string"},"library":{"title":"Library","type":"string","default":""},"displayed_prev_stages":{"items":{"type":"number","title":"Stage"},"title":"Background Stages","type":"array"}},"dependencies":{},"required":["name"]}')},307:function(e){e.exports=JSON.parse('{"title":"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0446\u0435\u043f\u043e\u0447\u043a\u0438","type":"object","required":["name"],"properties":{"name":{"type":"string","title":"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435"},"description":{"type":"string","title":"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435"}}}')},308:function(e){e.exports=JSON.parse('{"description":{"ui:widget":"textarea"}}')},337:function(e,t,n){},363:function(e,t,n){},553:function(e,t,n){},554:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(33),i=n.n(c),o=(n(337),n(41)),s=n(28),u=n(3),l=n.n(u),d=n(6),j=n(11),b=n(285),p=n(85),h=(Object(b.a)({apiKey:"AIzaSyCXiwOUNsbzKH7sbSAZrqA9f7VOeCMdUOQ",authDomain:"gigaturnip-b6b5b.firebaseapp.com",projectId:"gigaturnip-b6b5b",storageBucket:"gigaturnip-b6b5b.appspot.com",messagingSenderId:"414429242328",appId:"1:414429242328:web:a4685f5ac6895ea767c8ad",measurementId:"G-Y8JTEJMTET"}),Object(p.b)()),f=new p.a;f.setCustomParameters({prompt:"select_account"});var O=n(2),m=r.a.createContext(null),g=function(e){var t=e.children,n=Object(a.useState)(null),r=Object(j.a)(n,2),c=r[0],i=r[1],o=Object(a.useState)(!1),s=Object(j.a)(o,2),u=s[0],b=s[1];Object(a.useEffect)((function(){Object(p.d)(h,function(){var e=Object(d.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i(t||null),b(!0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[]);var g={user:c,ready:u,getToken:function(){var e=Object(d.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.c)(c);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),login:function(e){return Object(p.e)(h,f).then((function(t){var n=t.user;console.log(n),i(n),e()}))},logout:function(e){return Object(p.f)(h).then((function(){i(null),e()}))}};return Object(O.jsx)(m.Provider,{value:g,children:t})},x=function(){return r.a.useContext(m)},v={title:"Login",path:"/login"},y=n(626),S=function(e){var t=e.children,n=x(),a=Object(s.g)();return console.log(n),n.ready&&!n.user?Object(O.jsx)(s.a,{to:v.path,state:{from:a}}):n.ready?t:Object(O.jsx)(y.a,{})},w="api/v1/chains/",C="api/v1/taskstages/",k="api/v1/conditionalstages/",_=n(288),I=n.n(_),N=function(){var e=x().getToken,t=I.a.create({baseURL:"https://journal-bb5e3.uc.r.appspot.com/"});t.interceptors.request.use((function(t){return e().then((function(e){return e&&t&&t.headers&&(t.headers.Authorization="JWT "+e),t}))}),(function(e){return Promise.reject(e)}));return{axios:t,getCampaigns:function(){return t.get("".concat("api/v1/campaigns/","?limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getChains:function(e){return t.get("".concat(w,"?campaign=").concat(e,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},createChain:function(e){return t.post("".concat(w),e)},getStageNodes:function(e,n){return t.get("".concat(C,"?chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getLogicNodes:function(e,n){return t.get("".concat(k,"?chain__campaign=").concat(e,"&chain=").concat(n,"&limit=1000")).then((function(e){return e.data})).then((function(e){return e.results}))},getTaskStage:function(e){return t.get("".concat(C+e,"/")).then((function(e){return e.data}))},saveTaskStage:function(e,n){return t.patch("".concat(C+e,"/"),n)},getTaskStageOptions:function(){return t.options("".concat(C)).then((function(e){return e.data}))},getConditionalStage:function(e){return t.get("".concat(k+e,"/")).then((function(e){return e.data}))},saveConditionalStage:function(e,n){return t.patch("".concat(k+e,"/"),n)}}},E=n(635),T=n(630),D=n(624),F=n(629),B=n(631),L=n(623),P=n(627),A=function(e){var t=e.data,n=e.onClick,a=t.name,r=t.description,c=t.id;return Object(O.jsxs)(P.a,{children:[Object(O.jsxs)(F.a,{sx:{pb:1},children:[Object(O.jsx)(T.a,{variant:"h5",component:"div",children:a}),Object(O.jsxs)(T.a,{gutterBottom:!0,variant:"caption",color:"text.secondary",children:["ID: ",c]}),Object(O.jsx)(T.a,{overflow:"hidden",textOverflow:"ellipsis",variant:"body2",sx:{height:60,maxWidth:500},children:r})]}),Object(O.jsx)(B.a,{children:Object(O.jsx)(L.a,{size:"small",onClick:function(){n(c)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"})})]})},z=n(8),J=n(24),R=n(633),G=n(609),q=n(289),U=n.n(q),M=n(634),W=n(9),V=n(632),H=["expand"],X=Object(W.a)((function(e){e.expand;var t=Object(J.a)(e,H);return Object(O.jsx)(V.a,Object(z.a)({},t))}))((function(e){var t=e.theme;return{transform:e.expand?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:t.transitions.create("transform",{duration:t.transitions.duration.shortest})}})),Y=function(e){var t=e.data,n=e.children,r=e.hideExpandButton,c=e.hideOpenButton,i=e.onClick,o=t.name,s=(t.description,t.id),u=Object(a.useState)(!1),l=Object(j.a)(u,2),d=l[0],b=l[1],p=[];return c||p.push(Object(O.jsx)(L.a,{variant:"contained",onClick:function(){i&&i(s)},children:"\u041e\u0442\u043a\u0440\u044b\u0442\u044c"},"open_button")),r||p.push(Object(O.jsx)(X,{expand:d,onClick:function(){b(!d)},"aria-expanded":d,"aria-label":"show more",children:Object(O.jsx)(U.a,{})},"expand_button")),Object(O.jsxs)(P.a,{children:[Object(O.jsx)(R.a,{action:Object(O.jsx)(G.a,{direction:"row",spacing:1,children:p}),title:o,subheader:"ID: ".concat(s),titleTypographyProps:{variant:"h6"},subheaderTypographyProps:{variant:"caption"}}),Object(O.jsx)(M.a,{in:d,timeout:"auto",unmountOnExit:!0,children:Object(O.jsx)(F.a,{children:n})})]})},$=function(e){var t=e.data,n=e.view,a=e.onSelect;return t?"grid"===n?Object(O.jsx)(D.a,{container:!0,py:2,spacing:{xs:2,md:3},columns:{xs:4,sm:8,md:12},children:t.map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:2,sm:4,md:4,children:Object(O.jsx)(A,{data:e,onClick:a})},t)}))}):"list"===n?Object(O.jsx)(D.a,{container:!0,py:2,spacing:2,children:t.map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:12,children:Object(O.jsx)(Y,{data:e,hideExpandButton:!0,onClick:a})},t)}))}):null:Object(O.jsx)(T.a,{children:"Error"})},K=n(619),Q=n(290),Z=n.n(Q),ee=n(291),te=n.n(ee),ne=function(e){var t=e.label,n=e.view,a=e.location,r=e.hideLabel,c=e.hideCreateButton,i=e.hideViewButton,s=e.onViewChange;return Object(O.jsxs)(D.a,{container:!0,alignItems:"center",spacing:1,children:[Object(O.jsx)(D.a,{item:!0,flex:1,children:Object(O.jsx)(T.a,{hidden:r,variant:"h4",children:t})}),Object(O.jsx)(D.a,{item:!0,hidden:c,children:Object(O.jsx)(L.a,{component:o.b,to:"new",state:{from:a},variant:"contained",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"})}),Object(O.jsxs)(D.a,{item:!0,hidden:i,children:[Object(O.jsx)(K.a,{title:"\u0421\u0435\u0442\u043a\u0430",children:Object(O.jsx)(V.a,{color:"grid"===n?"primary":"default",onClick:function(){return s("grid")},children:Object(O.jsx)(Z.a,{})})}),Object(O.jsx)(K.a,{title:"\u0421\u043f\u0438\u0441\u043e\u043a",children:Object(O.jsx)(V.a,{color:"list"===n?"primary":"default",onClick:function(){return s("list")},children:Object(O.jsx)(te.a,{})})})]})]})},ae=function(e){var t=e.id,n=e.data,r=e.label,c=e.defaultView,i=e.hideLabel,o=e.hideCreateButton,u=e.hideViewButton,l=e.onSelect,d=Object(s.g)(),b=Object(a.useState)(null!==c&&void 0!==c?c:"grid"),p=Object(j.a)(b,2),h=p[0],f=p[1];Object(a.useEffect)((function(){if(!c){var e=localStorage.getItem("".concat(t,"_view"))||"grid";e&&f(e)}}),[]);return Object(O.jsxs)(E.a,{children:[Object(O.jsx)(ne,{label:r,hideLabel:i,view:h,onViewChange:function(e){f(e),localStorage.setItem("".concat(t,"_view"),e)},location:d,hideCreateButton:o,hideViewButton:u}),Object(O.jsx)($,{data:n,view:h,onSelect:l})]})},re=function(){var e=N().getCampaigns,t=Object(s.h)(),n=Object(a.useState)([]),r=Object(j.a)(n,2),c=r[0],i=r[1];Object(a.useEffect)((function(){e().then((function(e){return i(e)}))}),[]);return Object(O.jsx)(E.a,{px:3,py:1,children:Object(O.jsx)(ae,{id:"campaigns",data:c,hideCreateButton:!0,label:"\u041a\u0430\u043c\u043f\u0430\u043d\u0438\u0438",onSelect:function(e){t("/campaign/".concat(e,"/chain"))}})})},ce=function(){var e,t,n=x().login,a=Object(s.h)(),r=Object(s.g)(),c=(null===r||void 0===r||null===(e=r.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(L.a,{onClick:function(){n((function(){return a(c,{replace:!0})}))},children:"Login"})},ie=n(5),oe=n(42),se=n(625),ue=n(640),le=n(636),de=n(639),je=n(642),be=n(613),pe=n(641),he=n(293),fe=n.n(he),Oe=n(295),me=n.n(Oe),ge=n(294),xe=n.n(ge),ve=n(620),ye=n(637),Se=n(638),we=n(292),Ce=n.n(we),ke=240,_e=function(e){return{width:ke,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen}),overflowX:"hidden"}},Ie=function(e){return Object(ie.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:"calc(".concat(e.spacing(7)," + 1px)")},e.breakpoints.down("sm"),{width:0})},Ne=Object(W.a)("div")((function(e){var t=e.theme;return Object(z.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:t.spacing(0,1)},t.mixins.toolbar)})),Ee=Object(W.a)(le.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)({zIndex:t.zIndex.drawer+1,transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.leavingScreen})},n&&{marginLeft:ke,width:"calc(100% - ".concat(ke,"px)"),transition:t.transitions.create(["width","margin"],{easing:t.transitions.easing.sharp,duration:t.transitions.duration.enteringScreen})})})),Te=Object(W.a)(se.a,{shouldForwardProp:function(e){return"open"!==e}})((function(e){var t=e.theme,n=e.open;return Object(z.a)(Object(z.a)({width:ke,flexShrink:0,whiteSpace:"nowrap",boxSizing:"border-box"},n&&Object(z.a)(Object(z.a)({},_e(t)),{},{"& .MuiDrawer-paper":_e(t)})),!n&&Object(z.a)(Object(z.a)({},Ie(t)),{},{"& .MuiDrawer-paper":Ie(t)}))}));function De(e){var t=Object(oe.a)(),n=Object(s.i)().campaignId,a=Object(s.h)(),c=x().logout,i=r.a.useState(!1),u=Object(j.a)(i,2),l=u[0],d=u[1],b=e.children,p=[{page:"chain",title:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",icon:Object(O.jsx)(Ce.a,{})}];return Object(O.jsxs)(E.a,{sx:{display:"flex"},children:[Object(O.jsx)(be.a,{}),Object(O.jsx)(Ee,{position:"fixed",open:l,children:Object(O.jsxs)(de.a,{children:[n&&Object(O.jsx)(V.a,{color:"inherit","aria-label":"open drawer",onClick:function(){d(!0)},edge:"start",sx:Object(z.a)({marginRight:"36px"},l&&{display:"none"}),children:Object(O.jsx)(fe.a,{})}),Object(O.jsx)(E.a,{sx:{flexGrow:1},children:Object(O.jsx)(ue.a,{component:o.b,color:"inherit",underline:"none",variant:"h6",noWrap:!0,to:"/",sx:{"&:hover":{color:"white",boxShadow:"none"}},children:"GigaTurnip Admin Interface"})}),Object(O.jsx)(L.a,{color:"inherit",onClick:function(){return c((function(){return a("/")}))},children:"\u0412\u044b\u0445\u043e\u0434"})]})}),n&&Object(O.jsxs)(Te,{variant:"permanent",open:l,children:[Object(O.jsx)(Ne,{children:Object(O.jsx)(V.a,{onClick:function(){d(!1)},children:"rtl"===t.direction?Object(O.jsx)(xe.a,{}):Object(O.jsx)(me.a,{})})}),Object(O.jsx)(pe.a,{}),Object(O.jsx)(je.a,{children:p.map((function(e,t){return Object(O.jsxs)(ve.a,{component:o.b,to:"campaign/".concat(n,"/").concat(e.page),children:[Object(O.jsx)(ye.a,{children:e.icon}),Object(O.jsx)(Se.a,{primary:e.title})]},t)}))})]}),Object(O.jsxs)(E.a,{component:"main",sx:{flexGrow:1,width:"100%"},children:[Object(O.jsx)(Ne,{}),b]})]})}var Fe=function(){return Object(O.jsx)("div",{children:Object(O.jsx)(De,{children:Object(O.jsx)(s.b,{})})})},Be=function(){var e=N().getChains,t=Object(s.h)(),n=Object(s.i)().campaignId,r=Object(a.useState)([]),c=Object(j.a)(r,2),i=c[0],o=c[1];Object(a.useEffect)((function(){if(n){var t=parseInt(n);e(t).then((function(e){return o(e)}))}}),[]);return Object(O.jsx)(E.a,{px:3,py:1,children:Object(O.jsx)(ae,{id:"chains",data:i,label:"\u0426\u0435\u043f\u043e\u0447\u043a\u0438",onSelect:function(e){t("".concat(e))}})})},Le=n(25),Pe=n(62),Ae=Object(W.a)(E.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius}})),ze=function(e){var t=e.data,n=e.type;return Object(O.jsxs)(Ae,{type:n,children:[Object(O.jsx)(T.a,{children:t.label}),Object(O.jsx)(Pe.b,{type:"target",position:Pe.c.Top,style:{borderRadius:"100%",width:10,height:10}}),Object(O.jsx)(Pe.b,{type:"source",position:Pe.c.Bottom,style:{borderRadius:"100%",width:10,height:10}})]})},Je=Object(W.a)(ze)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main}})),Re=function(e){var t=e.data;return Object(O.jsx)(Je,{data:t,type:"logic"})},Ge=Object(W.a)(ze)((function(e){var t=e.theme;return{color:t.palette.success.contrastText,backgroundColor:t.palette.success.main}})),qe=function(e){var t=e.data;return Object(O.jsx)(Ge,{data:t,type:"stage"})},Ue=(n(363),n(203)),Me=n(119),We=n.n(Me),Ve=n(157),He=n.n(Ve),Xe=function(){var e=N().axios,t=function(e,t){return t.filter((function(t){return t.id===e})).pop()},n=function(e){return"STAGE"===e.type?C:"LOGIC"===e.type?k:void 0},a=function(){var t=Object(d.a)(l.a.mark((function t(a){var r,c,i,o,s,u,d,j,b;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=a.node,c=a.currentNodeId,i=a.type,o=a.method,!(s=n(r))){t.next=7;break}return t.next=5,e.get(s+r.id+"/").then((function(e){return"in"===i?e.data.in_stages:"out"===i?e.data.out_stages:void 0})).catch((function(e){}));case 5:(u=t.sent)&&(d=u.map((function(e){return e.toString()})),j=[],"create"===o&&(j=[c].concat(Object(Le.a)(d))),"delete"===o&&(j=d.filter((function(e){return e!==c}))),b=void 0,"in"===i&&(b={in_stages:j}),"out"===i&&(b={out_stages:j}),b&&(console.log(b),e.patch(s+r.id+"/",b)));case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=function(e,n,r){var c=t(e,r),i=t(n,r);c&&a({node:c,currentNodeId:n,type:"in",method:"delete"}),i&&a({node:i,currentNodeId:e,type:"out",method:"delete"})},c=function(){var t=Object(d.a)(l.a.mark((function t(a,r){var c,i,o;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(c={name:a.label,x_pos:Math.round(a.position.x),y_pos:Math.round(a.position.y),chain:r,out_stages:[]},!(i=n(a))){t.next=7;break}return t.next=5,e.post(i,c).then((function(e){return e.data})).catch((function(e){return console.log(e)}));case 5:return o=t.sent,t.abrupt("return",o.id.toString());case 7:return t.abrupt("return",void 0);case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{getFormFields:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(Ue.B)(e),a=Object(Ue.G)(n,"",e,t),r=function(e,t){return function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[""];return Object.keys(n).forEach((function(c){if("object"===typeof n[c]){var i=r.map((function(e){return"".concat(e,".").concat(c)}));n[c].__rjsf_additionalProperties&&""!==n[c].$name?a.push(n[c].$name):e(n[c],a,i)}else"$name"===c&&""!==n[c]&&r.forEach((function(e){e=e.replace(/^\./,"");var n=We()(t,e);("object"!==typeof n||He()(n))&&a.push(e)}))})),a}(e)};return r(a,t)},parseId:function(e){if(e)return parseInt(e);throw new Error("No id")},getNode:t,getUrl:n,updateConnections:a,addConnections:function(e,n,r){var c=t(e,r),i=t(n,r);c&&a({node:c,currentNodeId:n,type:"in",method:"create"}),i&&a({node:i,currentNodeId:e,type:"out",method:"create"})},removeConnections:r,removeElements:function(t,a){var c=t.map((function(e){return e.id}));return a.filter((function(t){if(c.includes(t.id)){if(Object(Pe.f)(t)){var i=parseInt(t.target),o=parseInt(t.source);r(i,o,a)}else{var s=n(t);s&&e.delete(s+t.id+"/")}return!1}return!0}))},updateNode:function(t){var a={x_pos:Math.round(t.position.x),y_pos:Math.round(t.position.y)},r=n(t);console.log(a),r&&e.patch(r+t.id+"/",a).then((function(e){return console.log(e.data)}))},createNode:c}},Ye=n(615),$e=Object(W.a)(E.a)((function(e){var t=e.theme,n=e.type;return{fontSize:"12px",width:"150px",textAlign:"center",color:"stage"===n?t.palette.success.contrastText:t.palette.primary.contrastText,backgroundColor:"stage"===n?t.palette.success.main:t.palette.primary.main,padding:t.spacing(1),borderRadius:t.shape.borderRadius,cursor:"grab",margin:8}})),Ke=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(""),i=Object(j.a)(c,2),o=i[0],s=i[1];Object(a.useEffect)((function(){r(!(!o||""===o))}),[o]);var u=function(e,t,n){var a=JSON.stringify({label:o,type:n});e.dataTransfer.setData("application/reactflow",a),e.dataTransfer.effectAllowed="move"},l=function(){s("")};return Object(O.jsxs)(D.a,{item:!0,container:!0,justifyContent:"center",px:1,children:[Object(O.jsxs)(D.a,{container:!0,item:!0,mt:2,justifyContent:"center",children:[Object(O.jsx)(Ye.a,{label:"Label",size:"small",value:o,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)(T.a,{py:1,variant:"caption",color:"red",align:"center",children:!n&&"Enter label to drag the node"})]}),Object(O.jsxs)(D.a,{item:!0,children:[Object(O.jsx)($e,{type:"stage",onDragEnd:l,onDragStart:function(e){return u(e,0,"STAGE")},draggable:n,children:"Taskstage Node"}),Object(O.jsx)($e,{type:"logic",onDragEnd:l,onDragStart:function(e){return u(e,0,"LOGIC")},draggable:n,children:"Conditional Node"})]})]})},Qe=function(){var e=Object(a.useRef)(null),t=N(),n=t.getStageNodes,r=t.getLogicNodes,c=Xe(),i=c.parseId,o=c.addConnections,u=c.createNode,b=c.removeElements,p=c.updateNode,h=Object(s.i)(),f=h.campaignId,m=h.chainId,g=Object(a.useState)(null),x=Object(j.a)(g,2),v=x[0],y=x[1],S=Object(a.useState)([]),w=Object(j.a)(S,2),C=w[0],k=w[1],_=Object(s.h)(),I=i(f),E=i(m),T={style:{strokeWidth:3},arrowHeadType:"arrow"};Object(a.useEffect)((function(){Promise.all([n(I,E),r(I,E)]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){return e.type="STAGE"})),n.forEach((function(e){return e.type="LOGIC"}));var a=[].concat(Object(Le.a)(t),Object(Le.a)(n)),r=a.map((function(e){return{id:e.id.toString(),position:{x:parseFloat(e.x_pos),y:parseFloat(e.y_pos)},data:{label:e.name},type:e.type}}));return k(r),a})).then((function(e){e.forEach((function(e){e.in_stages.length>0&&e.in_stages.forEach((function(t){var n=Object(z.a)({source:t.toString(),target:e.id.toString(),id:"".concat(t,"-").concat(e.id)},T);k((function(e){return Object(Pe.d)(n,e)}))}))}))}))}),[E]);var F=function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(z.a)(Object(z.a)({},t),T),a=n.target,r=n.source,k((function(e){return Object(Pe.d)(n,e)})),o(a,r,C);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),B=function(){var t=Object(d.a)(l.a.mark((function t(n){var a,r,c,i,o,s,d,j;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.preventDefault(),a=e.current.getBoundingClientRect(),r=n.dataTransfer.getData("application/reactflow"),c=v.project({x:n.clientX-a.left,y:n.clientY-a.top}),i=JSON.parse(r),o=i.label,s=i.type,""!==o){t.next=9;break}return t.abrupt("return",0);case 9:return t.next=11,u({type:s,position:c,label:o},E);case 11:d=t.sent,j={id:d,type:s,position:c,data:{label:o}},k((function(e){return[].concat(Object(Le.a)(e),[j])}));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=function(e,t){console.log(t),t.id&&("LOGIC"===t.type&&_("createlogic/".concat(t.id)),"STAGE"===t.type&&_("createstage/".concat(t.id)))},P={LOGIC:Re,STAGE:qe};return Object(O.jsxs)(D.a,{container:!0,children:[Object(O.jsx)(D.a,{item:!0,md:10,zIndex:1,children:Object(O.jsx)(Pe.e,{ref:e,nodeTypes:P,elements:C,onConnect:F,onElementsRemove:function(e){k((function(t){return b(e,t)}))},onNodeDoubleClick:L,onEdgeDoubleClick:L,onLoad:function(e){return y(e)},onDrop:B,onDragOver:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"},onNodeDragStop:function(e,t){p(t)},preventScrolling:!0,style:{width:"94vw",height:"90vh"},children:Object(O.jsx)(Pe.a,{})})}),Object(O.jsx)(D.a,{item:!0,md:2,zIndex:2,height:200,sx:{background:"white"},children:Object(O.jsx)(Ke,{})})]})},Ze=n(296),et=n.n(Ze),tt=Object(W.a)(V.a)((function(e){var t=e.theme;return{color:t.palette.primary.contrastText,backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.dark}}})),nt=function(e){var t=e.mode,n=e.allModes,a=e.onChange,r=e.onBack;return Object(O.jsxs)(E.a,{display:"flex",justifyContent:"flex-end",sx:{position:"sticky",top:60},p:1,zIndex:1,children:[Object(O.jsx)(E.a,{flex:1,children:Object(O.jsx)(K.a,{title:"\u041d\u0430\u0437\u0430\u0434",children:Object(O.jsx)(tt,{onClick:r,children:Object(O.jsx)(et.a,{fontSize:"large"})})})}),Object(O.jsx)(G.a,{direction:"row",spacing:1,children:Object.keys(n).map((function(e){var r=t===e?"primary":"default",c=n[e].title,i=n[e].icon;return Object(O.jsx)(E.a,{children:Object(O.jsx)(K.a,{title:c,children:Object(O.jsx)(V.a,{color:r,onClick:function(){return a(e)},children:i})})},e)}))})]})},at=function(e){e.id,e.schema,e.options,e.value,e.required,e.disabled,e.readonly,e.label,e.onChange,e.onBlur,e.onFocus;return Object(O.jsx)("p",{children:"\u0417\u0434\u0435\u0441\u044c \u0431\u0443\u0434\u0435\u0442 \u0430\u0443\u0434\u0438\u043e"})},rt=n(27),ct=function(e){var t=e.id,n=e.placeholder,a=e.required,r=e.readonly,c=e.disabled,i=e.label,o=e.value,s=e.onChange,u=e.onBlur,l=e.onFocus,d=e.autofocus,j=e.options,b=e.schema,p=e.rawErrors,h=void 0===p?[]:p,f="string"===b.type?"text":"".concat(b.type);return Object(O.jsxs)(rt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(rt.a.Label,{className:h.length>0?"text-danger":"",children:[i||b.title,(i||b.title)&&a?"*":null]}),Object(O.jsx)(rt.a.Control,{id:t,placeholder:n,autoFocus:d,required:a,disabled:c,readOnly:r,className:h.length>0?"is-invalid":"",list:b.examples?"examples_".concat(t):void 0,type:f,value:o||0===o?o:"",onChange:function(e){var t=e.target.value;return s(""===t?j.emptyValue:t)},onBlur:function(e){var n=e.target.value;return u(t,n)},onFocus:function(e){var n=e.target.value;return l(t,n)}}),b.examples?Object(O.jsx)("datalist",{id:"examples_".concat(t),children:b.examples.concat(b.default?[b.default]:[]).map((function(e){return Object(O.jsx)("option",{value:e},e)}))}):null]})},it=function(e){var t=e.required,n=e.label,a=e.value,r=e.schema,c=e.rawErrors,i=void 0===c?[]:c;return a?Object(O.jsxs)(rt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(rt.a.Label,{className:i.length>0?"text-danger":"",children:[n||r.title,(n||r.title)&&t?"*":null]}),Object(O.jsx)("br",{}),Object(O.jsx)("a",{href:a,children:a})]}):null},ot=function(e){var t=e.id,n=e.schema,a=e.options,r=e.value,c=e.required,i=e.disabled,o=e.readonly,s=e.label,u=e.onChange,l=e.onBlur,d=e.onFocus,j=a.enumOptions,b=a.enumDisabled,p=function(e){var t=e.target.value;return u("boolean"==n.type?"false"!==t:t)},h=function(e){var n=e.target.value;return l(t,n)},f=function(e){var n=e.target.value;return d(t,n)},m=Boolean(a&&a.inline);return Object(O.jsxs)(rt.a.Group,{className:"mb-0",children:[Object(O.jsxs)(rt.a.Label,{className:"d-block",children:[s||n.title,(s||n.title)&&c?"*":null]}),j.map((function(e,n){var a=Array.isArray(b)&&-1!==b.indexOf(e.value),s=e.value==r;return Object(O.jsx)(rt.a.Check,{inline:m,label:e.label,id:"".concat(t,"_").concat(e.label),name:t,type:"radio",disabled:i||a||o,checked:s,required:c,value:e.value,onChange:p,onBlur:h,onFocus:f},n)}))]})},st=n(309),ut=(n(282),function(e){var t=e.schema,n=e.uiSchema,a=e.formData,r=e.hideButton,c=e.onChange,i=e.onSubmit,o={customfile:at,autocomplete:ct,RadioWidget:ot,customlink:it,audio:at};return Object(O.jsx)(st.a,{schema:t,uiSchema:n,formData:a,widgets:o,onChange:function(e){if(!c)return 0;c(e.formData)},onSubmit:function(e){if(!i)return 0;i(e.formData)},children:r?" ":Object(O.jsx)("button",{type:"submit",className:"btn btn-primary",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})})}),lt=n(298),dt=n(21),jt={audio:{displayName:"Audio",matchIf:[{types:["string"],widget:"audio"}],possibleOptions:["private","default"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"audio","ui:options":{private:!1,default:""}},type:"string",cardBody:function(e){var t,n,a,r=e.parameters,c=e.onChange;return Object(O.jsxs)("div",{children:[Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=r["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return c(Object(z.a)(Object(z.a)({},r),{},{"ui:options":Object(z.a)(Object(z.a)({},r["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsx)("h5",{children:"Default Audio (Link)"}),Object(O.jsx)(dt.f,{value:null!==(n=null===(a=r["ui:options"])||void 0===a?void 0:a.default)&&void 0!==n?n:"",placeholder:"Default",type:"text",onChange:function(e){return c(Object(z.a)(Object(z.a)({},r),{},{"ui:options":Object(z.a)(Object(z.a)({},r["ui:options"]),{},{default:e.target.value})}))},className:"card-text"})]})}}},bt={autocomplete:{displayName:"AutoComplete",matchIf:[{types:["string"],widget:"autocomplete"}],possibleOptions:["webhook","params","searchField","responseField"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"autocomplete","ui:options":{webhook:"",params:"",searchField:"",responseField:""}},type:"string",cardBody:function(e){var t,n,a,c,i=e.parameters,o=e.onChange;return Object(O.jsxs)(r.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Webhook"}),Object(O.jsx)(dt.f,{value:null===(t=i["ui:options"])||void 0===t?void 0:t.webhook,placeholder:"Webhook",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{webhook:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsx)("h5",{children:"Params"}),Object(O.jsx)(dt.f,{value:null===(n=i["ui:options"])||void 0===n?void 0:n.params,placeholder:"Params",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{params:e.target.value})}))},className:"card-text"}),Object(O.jsx)("br",{}),Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{width:"100%",paddingRight:7},children:[Object(O.jsx)("h5",{children:"Search Field"}),Object(O.jsx)(dt.f,{value:null===(a=i["ui:options"])||void 0===a?void 0:a.searchField,placeholder:"Search Field",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{searchField:e.target.value})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{width:"100%",paddingLeft:7},children:[Object(O.jsx)("h5",{children:"Response Field"}),Object(O.jsx)(dt.f,{value:null===(c=i["ui:options"])||void 0===c?void 0:c.responseField,placeholder:"Response Field",type:"text",onChange:function(e){return o(Object(z.a)(Object(z.a)({},i),{},{"ui:options":Object(z.a)(Object(z.a)({},i["ui:options"]),{},{responseField:e.target.value})}))},className:"card-text"})]})]})]})}}},pt={file:{displayName:"File",matchIf:[{types:["string"],widget:"customfile"}],possibleOptions:["private","multiple"],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customfile","ui:options":{private:!1,multiple:!1}},type:"string",cardBody:function(e){var t,n,a=e.parameters,r=e.onChange;return Object(O.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center"},children:[Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Private Upload"}),Object(O.jsx)("input",{checked:null===(t=a["ui:options"])||void 0===t?void 0:t.private,type:"checkbox",onChange:function(e){return r(Object(z.a)(Object(z.a)({},a),{},{"ui:options":Object(z.a)(Object(z.a)({},a["ui:options"]),{},{private:e.target.checked})}))},className:"card-text"})]}),Object(O.jsxs)("div",{style:{display:"flex",alignItems:"baseline",padding:"0 10px"},children:[Object(O.jsx)("h5",{style:{padding:"0 5px"},children:"Multiple Files"}),Object(O.jsx)("input",{checked:null===(n=a["ui:options"])||void 0===n?void 0:n.multiple,type:"checkbox",onChange:function(e){return r(Object(z.a)(Object(z.a)({},a),{},{"ui:options":Object(z.a)(Object(z.a)({},a["ui:options"]),{},{multiple:e.target.checked})}))},className:"card-text"})]})]})}}},ht={link:{displayName:"Link",matchIf:[{types:["string"],widget:"customlink"}],defaultDataSchema:{},defaultUiSchema:{"ui:widget":"customlink"},type:"string",cardBody:function(e){var t,n=e.parameters,a=e.onChange;return Object(O.jsxs)(r.a.Fragment,{children:[Object(O.jsx)("h5",{children:"Default value"}),Object(O.jsx)(dt.f,{value:null!==(t=n.default)&&void 0!==t?t:"",placeholder:"Default",type:"text",onChange:function(e){return a(Object(z.a)(Object(z.a)({},n),{},{default:e.target.value}))},className:"card-text"})]})}}},ft=n(310),Ot=function(e){var t=e.schema,n=e.uiSchema,a=e.onChange,r=Object(z.a)(Object(z.a)(Object(z.a)(Object(z.a)({},pt),bt),ht),jt);return Object(O.jsx)(ft.a,{schema:t,uischema:n,onChange:function(e,t){a(e,t)},mods:{customFormInputs:r}})},mt=Object(W.a)(E.a)((function(){return{width:"70%",minWidth:"400px",margin:"0 auto"}})),gt=function(e){var t=e.schema,n=e.uiSchema,a=e.formData,r=e.onSchemaChange,c=e.onFormDataChange,i=Object(z.a)({},lt);return Object(O.jsxs)(E.a,{p:1,children:[Object(O.jsx)(Ot,{schema:t,uiSchema:n,onChange:r}),Object(O.jsx)(mt,{children:Object(O.jsx)(ut,{schema:i,uiSchema:{displayed_prev_stages:{"ui:widget":"checkboxes"}},formData:a,onChange:c,hideButton:!0})})]})},xt=n(160),vt=function(e){var t=e.data;return Object(O.jsx)(xt.a,{id:"ViewerTinyMCE",value:t,toolbar:!1,inline:!1,disabled:!0,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autoresize",menubar:!1,image_advtab:!0,importcss_append:!0}})},yt=function(e){var t=e.schema,n=e.uiSchema,a=e.text;return Object(O.jsxs)(mt,{children:[a&&Object(O.jsx)(vt,{data:a}),Object(O.jsx)(E.a,{py:1,children:Object(O.jsx)(ut,{schema:t,uiSchema:n})})]})},St=n(643),wt=n(644),Ct=n(645),kt=function(e){var t=e.isEditable,n=e.schema,a=e.ui,r=e.onSchemaChange,c=e.onUiChange,i=e.onIsEditableChange,o=e.onSave,s=e.onUndo,u=n,l=a;try{var d=JSON.parse(n);u=JSON.stringify(d,null,2);var j=JSON.parse(a);l=JSON.stringify(j,null,2)}catch(b){console.log(b)}return Object(O.jsxs)(E.a,{children:[Object(O.jsxs)(D.a,{container:!0,alignItems:"center",children:[Object(O.jsx)(St.a,{sx:{my:1},children:Object(O.jsx)(wt.a,{control:Object(O.jsx)(Ct.a,{checked:t,onChange:function(){i()},name:"edit",inputProps:{"aria-label":"edit"}}),labelPlacement:"start",label:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"})}),t&&Object(O.jsx)(L.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){o()},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"}),t&&Object(O.jsx)(L.a,{sx:{m:1},color:"primary",variant:"contained",onClick:function(){s()},children:"\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f"})]}),Object(O.jsxs)(D.a,{container:!0,children:[Object(O.jsx)(D.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(Ye.a,{label:"Schema",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:u,onChange:function(e){r(e.target.value)},style:{marginTop:15,marginBottom:15}})}),Object(O.jsx)(D.a,{item:!0,xs:12,md:6,p:1,children:Object(O.jsx)(Ye.a,{label:"Ui",multiline:!0,fullWidth:!0,variant:"outlined",InputProps:{readOnly:!t},value:l,onChange:function(e){c(e.target.value)},style:{marginTop:15,marginBottom:30}})})]})]})},_t=n(301),It=function(e){var t=e.id,n=N().getTaskStageOptions,r=Object(a.useState)({}),c=Object(j.a)(r,2),i=c[0],o=c[1],s=function(){var e=Object(d.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n();case 2:if(!(t=e.sent)){e.next=7;break}return e.abrupt("return",t.actions.POST);case 7:return e.abrupt("return",void 0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(e){var t=["string","number","integer","boolean","null"],n=e?Object.keys(e):[],a={},r=[];n.forEach((function(n){var c=e[n],i=c.type,o=c.label,s=c.help_text,u=c.required;t.includes(i)?(a[n]={type:i,title:o,description:s},u&&r.push(n)):"decimal"===i&&(a[n]={type:"number",title:o,description:s},u&&r.push(n))}));var c={type:"object",properties:a,required:r};return console.log(c),c};return Object(a.useEffect)((function(){t&&function(){var e=Object(d.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s();case 2:t=e.sent,n=u(t),o(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(O.jsx)("div",{children:Object(O.jsx)(ut,{schema:i})})},Nt=function(e){Object(_t.a)(e);return Object(O.jsx)(mt,{children:Object(O.jsx)(D.a,{container:!0,py:2,spacing:2,children:[1,2].map((function(e,t){return Object(O.jsx)(D.a,{item:!0,xs:12,children:Object(O.jsx)(Y,{data:{name:e},hideOpenButton:!0,children:Object(O.jsx)(It,{id:e})})},t)}))})})},Et=(n(553),function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(xt.a,{id:"EditorTinyMCE",onEditorChange:function(e,t){n(e)},value:t,tinymceScriptSrc:"/gigaturnip-frontend/tinymce/tinymce.min.js",init:{plugins:"autosave save print preview paste importcss searchreplace autolink directionality code visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern noneditable help charmap emoticons autoresize",menubar:"file edit view insert format tools table help",toolbar:"undo redo | bold italic underline strikethrough | fontselect fontsizeselect formatselect | alignleft aligncenter alignright alignjustify | outdent indent |  numlist bullist | forecolor backcolor removeformat | pagebreak | charmap emoticons | fullscreen  preview save print | insertfile image media link anchor codesample | ltr rtl",toolbar_sticky:!0,image_advtab:!0,importcss_append:!0,image_caption:!0,noneditable_noneditable_class:"mceNonEditable",toolbar_mode:"sliding",contextmenu:"link image imagetools table",autosave_prefix:"tinymce-autosave-{path}{query}-",content_style:"body { font-family:Helvetica,Arial,sans-serif; font-size:14px }"}})}),Tt=function(e){var t=e.data,n=e.onChange;return Object(O.jsx)(mt,{children:Object(O.jsx)(Et,{data:t,onChange:n})})},Dt=n(618),Ft=n(621),Bt=r.a.createContext(null),Lt=r.a.forwardRef((function(e,t){return Object(O.jsx)(Dt.a,Object(z.a)({elevation:6,ref:t,variant:"filled"},e))})),Pt=function(e){var t=e.children,n=Object(a.useState)(!1),r=Object(j.a)(n,2),c=r[0],i=r[1],o=Object(a.useState)(""),s=Object(j.a)(o,2),u=s[0],l=s[1],d=Object(a.useState)("error"),b=Object(j.a)(d,2),p=b[0],h=b[1],f=function(e,t){"clickaway"!==t&&i(!1)},m={open:c,openToast:function(e,t){t&&h(t),l(function(e){switch(typeof e){case"string":return e;case"object":return JSON.stringify(e);default:return String(e)}}(e)),i(!0)},closeToast:f};return Object(O.jsxs)(Bt.Provider,{value:m,children:[Object(O.jsx)(Ft.a,{open:c,autoHideDuration:5e3,onClose:f,anchorOrigin:{vertical:"top",horizontal:"center"},children:Object(O.jsx)(Lt,{onClose:f,severity:p,sx:{width:"100%"},children:u})}),t]})},At=function(){return r.a.useContext(Bt)},zt=n(303),Jt=n.n(zt),Rt=n(304),Gt=n.n(Rt),qt=n(305),Ut=n.n(qt),Mt=n(306),Wt=n.n(Mt),Vt=n(302),Ht=n.n(Vt),Xt=["id","json_schema","ui_schema","rich_text","webhook_address","webhook_params"],Yt=["chain","webhook_params"],$t=function(){var e=Object(s.i)().stageId,t=Object(s.h)(),n=N(),r=n.getTaskStage,c=n.saveTaskStage,i=(0,Xe().parseId)(e),o=At().openToast,u=Object(a.useState)(""),b=Object(j.a)(u,2),p=b[0],h=b[1],f=Object(a.useState)(""),m=Object(j.a)(f,2),g=m[0],x=m[1],v=Object(a.useState)({}),y=Object(j.a)(v,2),S=y[0],w=y[1],C=Object(a.useState)("builder"),k=Object(j.a)(C,2),_=k[0],I=k[1],T=Object(a.useState)(""),D=Object(j.a)(T,2),F=D[0],B=D[1],P=Object(a.useState)(!1),A=Object(j.a)(P,2),R=A[0],G=A[1],q=Object(a.useState)(""),U=Object(j.a)(q,2),M=U[0],W=U[1],V=Object(a.useState)(""),H=Object(j.a)(V,2),X=H[0],Y=H[1],$=Object(a.useState)(""),K=Object(j.a)($,2),Q=K[0],Z=K[1],ee=Object(a.useState)(""),te=Object(j.a)(ee,2),ne=te[0],ae=te[1],re=p?JSON.parse(p):{},ce=g?JSON.parse(g):{},ie={builder:{title:"\u041a\u043e\u043d\u0441\u0442\u0440\u0443\u043a\u0442\u043e\u0440",icon:Object(O.jsx)(Jt.a,{fontSize:"large"})},text:{title:"\u0422\u0435\u043a\u0441\u0442",icon:Object(O.jsx)(Gt.a,{fontSize:"large"})},preview:{title:"\u041f\u0440\u0435\u0432\u044c\u044e",icon:Object(O.jsx)(Ut.a,{fontSize:"large"})},editor:{title:"\u0421\u0445\u0435\u043c\u044b",icon:Object(O.jsx)(Wt.a,{fontSize:"large"})}};Object(a.useEffect)((function(){i&&function(){var e=Object(d.a)(l.a.mark((function e(t){var n,a,c,i,o,s,u;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(t);case 2:n=e.sent,n.id,a=n.json_schema,c=n.ui_schema,i=n.rich_text,o=n.webhook_address,s=n.webhook_params,(u=Object(J.a)(n,Xt)).webhook_address=o||void 0,u.webhook_params=s?JSON.stringify(s):void 0,h(a),x(c),W(a),Y(c),Z(a),ae(c),w(u),B(i);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(i)}),[i]);var oe=Object(a.useCallback)((function(){S.chain;var e,t=S.webhook_params,n=Object(J.a)(S,Yt);try{e=JSON.parse(t)}catch(a){e=null}return Object(z.a)(Object(z.a)({},n),{},{json_schema:p,ui_schema:g,rich_text:F,webhook_params:e})}),[S,p,F,g]),se=function(e){return c(i,e)},ue=Object(a.useCallback)(Ht()((function(e){se(e).then((function(){return console.log("saved")})).catch((function(e){return o(e.message,"error")}))}),2e3),[]);Object(a.useEffect)((function(){var e=oe();ue(e)}),[S,p,g,F,ue,oe]);var le=function(e,t){h(e),x(t),Z(e),ae(t),W(e),Y(t)},de=function(e){w(e)},je=function(e){B(e)},be=function(){G(!R)},pe=function(e){W(e)},he=function(e){Y(e)},fe=function(){h(M),x(X)},Oe=function(){h(Q),x(ne),W(Q),Y(ne)};return Object(O.jsxs)(E.a,{children:[Object(O.jsx)(nt,{allModes:ie,mode:_,onChange:function(e){I(e)},onBack:function(){t(-1)}}),function(e){switch(e){case"builder":return Object(O.jsx)(gt,{schema:p,uiSchema:g,formData:S,onSchemaChange:le,onFormDataChange:de});case"plugins":return Object(O.jsx)(Nt,{});case"text":return Object(O.jsx)(Tt,{data:F,onChange:je});case"preview":return Object(O.jsx)(yt,{schema:re,uiSchema:ce,text:F});case"editor":return Object(O.jsx)(kt,{isEditable:R,schema:M,ui:X,onSchemaChange:pe,onUiChange:he,onIsEditableChange:be,onSave:fe,onUndo:Oe})}}(_),Object(O.jsx)(mt,{pb:3,children:Object(O.jsx)(L.a,{variant:"contained",color:"warning",fullWidth:!0,onClick:function(){var e=oe();se(e).then((function(){return o("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")})).catch((function(e){return o(e.message,"error")}))},children:"\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c"})})]})},Kt=n(622),Qt=function(){var e=N(),t=e.getConditionalStage,n=e.saveConditionalStage,r=e.getTaskStage,c=Object(s.i)().stageId,i=Xe(),o=i.parseId,u=i.getFormFields,b=o(c),p=At().openToast,h=Object(a.useState)({}),f=Object(j.a)(h,2),m=f[0],g=f[1],x=Object(a.useState)({}),v=Object(j.a)(x,2),y=v[0],S=v[1],w=Object(a.useState)(!1),C=Object(j.a)(w,2),k=C[0],_=C[1],I=Object(a.useState)(),E=Object(j.a)(I,2),T=E[0],D=E[1],F=Object(a.useState)(!1),B=Object(j.a)(F,2),L=B[0],P=B[1],A=Object(a.useState)([]),J=Object(j.a)(A,2),R=J[0],G=J[1];Object(a.useEffect)((function(){t(b).then((function(e){S(e.conditions),_(e.pingpong)}))}),[b]),Object(a.useEffect)((function(){var e=function(e){if(e){var n=r(e);return n||t(e)}return t(b)};b&&function(){var t=Object(d.a)(l.a.mark((function t(){var n,a,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(n=t.sent,!(a=k?n.out_stages:n.in_stages)){t.next=9;break}return t.next=7,Promise.all(a.map(function(){var t=Object(d.a)(l.a.mark((function t(n){var a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e(n);case 2:return a=t.sent,t.abrupt("return",Object(ie.a)({},n,a));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 7:r=t.sent,Object.keys(r).length>0&&(D(r),P(!0));case 9:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()()}),[b,k]),Object(a.useEffect)((function(){if(T&&T.length>0){var e=T.map((function(e){var t=Object.values(e)[0],n=t.json_schema?JSON.parse(t.json_schema):{},a={};n&&n.dependencies&&Object.keys(n.dependencies).length>0&&(a=n.dependencies);var r=Object.values(a),c=u(n),i=[];return r.length>0&&(i=r.map((function(e){return function(e){var t=null;return e.hasOwnProperty("oneOf")&&(t=e.oneOf),e.hasOwnProperty("allOf")&&(t=e.allOf),t?t.map((function(e){var t=Object(z.a)({type:"object"},e);return u(t)})).flat():[]}(e)})).flat()),Array.from(new Set([].concat(Object(Le.a)(c),Object(Le.a)(i))))})).flat();G(e)}}),[T]),Object(a.useEffect)((function(){console.log("fields",R),g({items:{type:"object",title:"Logic",properties:{field:{enum:R,title:"Field",type:"string"},condition:{enum:["==","!=",">","<",">=","<=","ARRAY-CONTAINS","ARRAY-CONTAINS-NOT"],title:"Condition",type:"string"},value:{title:"Value",type:"string"}},dependencies:{},required:[]},title:"Logic Array",type:"array",dependencies:{},required:[]})}),[R]);return L?Object(O.jsxs)(mt,{pb:3,children:[Object(O.jsx)(wt.a,{control:Object(O.jsx)(Kt.a,{checked:k,onChange:function(e){_(e.target.checked)},name:"PingPong",color:"primary"}),label:"Ping Pong"}),Object(O.jsx)(ut,{schema:m,formData:y,onChange:function(e){return S(e)},onSubmit:function(){n(b,{conditions:y,pingpong:k}).then((function(e){return p("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u044b","success")}))}})]}):Object(O.jsx)("p",{children:"No node connection or end_ui detected. Connect to one or check if form has fields."})},Zt=n(307),en=n(308),tn=function(){var e,t,n=N().createChain,a=Object(s.h)(),r=Object(s.g)(),c=Object(s.i)().campaignId,i=(0,Xe().parseId)(c),o=(null===r||void 0===r||null===(e=r.state)||void 0===e||null===(t=e.from)||void 0===t?void 0:t.pathname)||"/";return Object(O.jsx)(mt,{py:2,children:Object(O.jsx)(ut,{schema:Zt,uiSchema:en,onSubmit:function(e){console.log(e),c?n(Object(z.a)({campaign:i},e)).then((function(){a(o)})):alert("Error: No campaign id")}})})},nn=function(){return Object(O.jsx)(g,{children:Object(O.jsx)(Pt,{children:Object(O.jsx)(o.a,{children:Object(O.jsxs)(s.e,{children:[Object(O.jsxs)(s.c,{path:"/",element:Object(O.jsx)(S,{children:Object(O.jsx)(Fe,{})}),children:[Object(O.jsxs)(s.c,{path:"campaign",children:[Object(O.jsx)(s.c,{path:":campaignId",children:Object(O.jsxs)(s.c,{path:"chain",children:[Object(O.jsxs)(s.c,{path:":chainId",children:[Object(O.jsx)(s.c,{path:"createstage/:stageId",element:Object(O.jsx)($t,{})}),Object(O.jsx)(s.c,{path:"createlogic/:stageId",element:Object(O.jsx)(Qt,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Qe,{})})]}),Object(O.jsx)(s.c,{path:"new",element:Object(O.jsx)(tn,{})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(Be,{})})]})}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{index:!0,element:Object(O.jsx)(re,{})})]}),Object(O.jsx)(s.c,{path:v.path,element:Object(O.jsx)(ce,{})})]})})})})},an=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,646)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(nn,{})}),document.getElementById("root")),an()}},[[554,1,2]]]);
//# sourceMappingURL=main.61787984.chunk.js.map